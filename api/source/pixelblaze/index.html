
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.5.3">
    
    
      
        <title>pixelblaze - pixelblaze-client documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7a952b86.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/all.css">
    
      <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/v4-shims.css">
    
      <link rel="stylesheet" href="../../../css/mkapi-common.css">
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pixelblaze" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="pixelblaze-client documentation" class="md-header__button md-logo" aria-label="pixelblaze-client documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            pixelblaze-client documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              pixelblaze
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../.." class="md-tabs__link">
      pixelblaze-client
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../how-to-guides/" class="md-tabs__link">
      How-To Guides
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../pixelblaze/" class="md-tabs__link">
      Pixelblaze
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../pixelblazeProtocol/" class="md-tabs__link">
      The Pixelblaze protocol
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../tutorials/" class="md-tabs__link">
      Tutorials
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../.." class="md-tabs__link">
      API
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="pixelblaze-client documentation" class="md-nav__button md-logo" aria-label="pixelblaze-client documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    pixelblaze-client documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        pixelblaze-client
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../how-to-guides/" class="md-nav__link">
        How-To Guides
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../pixelblaze/" class="md-nav__link">
        Pixelblaze
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../pixelblazeProtocol/" class="md-nav__link">
        The Pixelblaze protocol
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/" class="md-nav__link">
        Tutorials
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        API
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<div class="mkapi-node">
<h1 id="" class="mkapi-object mkapi-object-code plain">
<span class="mkapi-object-kind mkapi-object-kind-code">SOURCE CODE</span>
<span class="mkapi-object-name">pixelblaze</span>
<span id="pixelblaze"></span><a class="mkapi-docs-link" href="../../pixelblaze">DOCS</a>
</h1>

<div class="mkapi-code">
<div class="codehilite"><pre><span></span><code><span class="ch">#!/usr/bin/python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A library that provides a simple, synchronous interface for communicating with and controlling Pixelblaze LED controllers.</span>

<span class="sd">This module contains the following classes:</span>

<span class="sd">- [`Pixelblaze`](#class-pixelblaze): an object for controlling Pixelblazes.</span>

<span class="sd">- [`PBB`](#class-pbb): an object for creating and manipulating Pixelblaze Binary Backups.</span>

<span class="sd">- [`PBP`](#class-pbp): an object for creating and manipulating Pixelblaze Binary Patterns.</span>

<span class="sd">- [`EPE`](#class-epe): an object for creating and manipulating Electromage Pattern Exports.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="c1"># Copyright 2020-2022 by the pixelblaze-client team</span>
<span class="c1">#</span>
<span class="c1"># Permission is hereby granted, free of charge, to any person obtaining a copy of this</span>
<span class="c1"># software and associated documentation files (the &quot;Software&quot;), to deal in the Software</span>
<span class="c1"># without restriction, including without limitation the rights to use, copy, modify, merge,</span>
<span class="c1"># publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons</span>
<span class="c1"># to whom the Software is furnished to do so, subject to the following conditions:</span>
<span class="c1">#</span>
<span class="c1"># The above copyright notice and this permission notice shall be included in all copies or</span>
<span class="c1"># substantial portions of the Software.</span>
<span class="c1">#</span>
<span class="c1"># THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING</span>
<span class="c1"># BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE</span>
<span class="c1"># AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY</span>
<span class="c1"># CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,</span>
<span class="c1"># ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="c1"># THE SOFTWARE.</span>
<span class="c1">#</span>

<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;1.0.0&quot;</span>

<span class="c1">#| Version | Date       | Author        | Comment                                 |</span>
<span class="c1">#|---------|------------|---------------|-----------------------------------------|</span>
<span class="c1">#|  v1.0.0 | 01/10/2022 | @pixie        | large-scale refactoring to add new features; minor loss of compatibility |</span>
<span class="c1">#|  v0.9.6 | 07/17/2022 | @pixie        | Tweak getPatternList() to handle slower Pixelblazes |</span>
<span class="c1">#|  v0.9.5 | 07/16/2022 | @pixie        | Update ws_recv to receive long preview packets |</span>
<span class="c1">#|  v0.9.4 | 02/04/2022 | &quot;             | Added setPixelcount(), pause(), unpause(), pattern cache |</span>
<span class="c1">#|  v0.9.3 | 04/13/2021 | &quot;             | waitForEmptyQueue() return now agrees w/docs |</span>
<span class="c1">#|  v0.9.2 | 01/16/2021 | &quot;             | Updated Pixelblaze sequencer support |</span>
<span class="c1">#|  v0.9.1 | 12/16/2020 | &quot;             | Support for pypi upload |</span>
<span class="c1">#|  v0.9.0 | 12/06/2020 | &quot;             | Added PixelblazeEnumerator class |</span>
<span class="c1">#|  v0.0.2 | 12/01/2020 | &quot;             | Name change + color control methods |</span>
<span class="c1">#|  v0.0.1 | 11/20/2020 | ZRanger1      |  Created |</span>

<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="c1">#   Standard library imports.</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">errno</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">pytz</span>
<span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="n">T</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span><span class="p">,</span> <span class="n">Flag</span><span class="p">,</span> <span class="n">IntEnum</span><span class="p">,</span> <span class="n">IntFlag</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span><span class="p">,</span> <span class="n">urljoin</span>

<span class="c1">#   Related third party imports.</span>
<span class="kn">import</span> <span class="nn">websocket</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="c1">#   Local application/library specific imports.</span>
<span class="c1">#   -None-</span>

<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="k">class</span> <span class="nc">Pixelblaze</span><span class="p">:</span><span id="pixelblaze.Pixelblaze"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze" href="../../pixelblaze/#pixelblaze.Pixelblaze">DOCS</a>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Pixelblaze class presents a simple synchronous interface to a single Pixelblaze&#39;s websocket API.</span>

<span class="sd">    The constructor takes the Pixelblaze&#39;s IPv4 address in the usual 12 digit numeric form (for example, &quot;192.168.4.1&quot;). To control multiple Pixelblazes, create multiple objects.</span>

<span class="sd">    The objective is to provide 99% coverage of the functionality of the Pixelblaze webUI, and so the supported methods are named and grouped according to the tabs of the webUI:</span>

<span class="sd">    **CREATION**</span>

<span class="sd">    - [`__init__()`](#method-init)</span>
<span class="sd">    - [`EnumerateAddresses()`](#method-enumerateaddresses)</span>
<span class="sd">    - [`EnumerateDevices()`](#method-enumeratedevices)</span>

<span class="sd">    **PATTERNS tab**</span>

<span class="sd">    *SEQUENCER section*</span>

<span class="sd">    - [`getSequencerMode`](#method-getSequencerMode)/[`setSequencerMode`](#method-setSequencerMode)</span>
<span class="sd">    - [`getSequencerState`](#method-getSequencerState)/[`setSequencerState`](#method-setSequencerState)</span>
<span class="sd">    - [`getSequencerShuffleTime`](#method-getSequencerShuffleTime)/[`setSequencerShuffleTime`](#method-setSequencerShuffleTime)</span>
<span class="sd">    - [`getSequencerPlaylist`](#method-getSequencerPlaylist)/[`addToSequencerPlaylist`](#method-addToSequencerPlaylist)/[`setSequencerPlaylist`](#method-setSequencerPlaylist)</span>

<span class="sd">    *SAVED PATTERNS section*</span>

<span class="sd">    - [`getPatternList`](#method-getPatternList)</span>
<span class="sd">    - [`getActivePattern`](#method-getActivePattern)/[`setActivePattern`](#method-setActivePattern)</span>
<span class="sd">    - [`getActiveVariables`](#method-getActiveVariables)/[`setActiveVariables`](#method-setActiveVariables)</span>
<span class="sd">    - [`getActiveControls`](#method-getActiveControls)/[`setActiveControls`](#method-setActiveControls)</span>
<span class="sd">    - [`deletePattern`](#method-deletePattern)</span>
<span class="sd">    - [`getPatternAsEpe`](#method-getPatternAsEpe)</span>

<span class="sd">    **EDIT tab**</span>

<span class="sd">    - [`getPatternControls`](#method-getPatternControls)</span>
<span class="sd">    - [`getPatternSourceCode`](#method-getPatternSourceCode)</span>
<span class="sd">    - [`sendPatternToRenderer`](#method-sendPatternToRenderer)</span>
<span class="sd">    - [`savePattern`](#method-savePattern)</span>

<span class="sd">    **MAPPER tab**</span>

<span class="sd">    - [`getMapFunction`](#method-getMapFunction)/[`setMapFunction`](#method-setMapFunction)</span>
<span class="sd">    - [`getMapData`](#method-getMapData)/[`setMapData`](#method-setMapData)</span>

<span class="sd">    **SETTINGS tab**</span>

<span class="sd">    - [`getConfigSettings`](#method-getConfigSettings)</span>
<span class="sd">    - [`getConfigSequencer`](#method-getConfigSequencer)</span>
<span class="sd">    - [`getConfigExpander`](#method-getConfigExpander)</span>

<span class="sd">    ***NAME section***</span>

<span class="sd">    - [`getDeviceName`](#method-getDeviceName)/[`setDeviceName`](#method-setDeviceName)</span>
<span class="sd">    - [`getDiscovery`](#method-getDiscovery)/[`setDiscovery`](#method-setDiscovery)</span>
<span class="sd">    - [`getTimezone`](#method-getTimezone)/[`setTimezone`](#method-setTimezone)</span>
<span class="sd">    - [`getAutoOffEnable`](#method-getAutoOffEnable)/[`setAutoOffEnable`](#method-setAutoOffEnable)</span>
<span class="sd">    - [`getAutoOffStart`](#method-getAutoOffStart)/[`setAutoOffStart`](#method-setAutoOffStart)</span>
<span class="sd">    - [`getAutoOffEnd`](#method-getAutoOffEnd)/[`setAutoOffEnd`](#method-setAutoOffEnd)</span>

<span class="sd">    ***LED section***</span>

<span class="sd">    - [`getBrightnessLimit`](#method-getBrightnessLimit)/[`setBrightnessLimit`](#method-setBrightnessLimit)</span>
<span class="sd">    - [`getLedType`](#method-getLedType)/[`setLedType`](#method-setLedType)</span>
<span class="sd">    - [`getPixelCount`](#method-getPixelCount)/[`setPixelCount`](#method-setPixelCount)</span>
<span class="sd">    - [`getDataSpeed`](#method-getDataSpeed)/[`setDataSpeed`](#method-setDataSpeed)</span>
<span class="sd">    - [`getColorOrder`](#method-getColorOrder)/[`setColorOrder`](#method-setColorOrder)</span>
<span class="sd">    - [`getCpuSpeed`](#method-getCpuSpeed)/[`setCpuSpeed`](#method-setCpuSpeed)</span>
<span class="sd">    - [`getNetworkPowerSave`](#method-getNetworkPowerSave)/[`setNetworkPowerSave`](#method-setNetworkPowerSave)</span>

<span class="sd">    ***UPDATES section***</span>

<span class="sd">    - [`getUpdateState`](#method-getUpdateState)/[`installUpdate`](#method-installUpdate)</span>
<span class="sd">    - [`getVersion`](#method-getVersion)/[`getVersionMajor`](#method-getVersionMajor)/[`getVersionMinor`](#method-getVersionMinor)/</span>

<span class="sd">    ***BACKUPS section***</span>

<span class="sd">    - [`saveBackup`](#method-saveBackup)/[`restoreFromBackup`](#method-restoreFromBackup)</span>
<span class="sd">    - [`reboot`](#method-reboot)</span>

<span class="sd">    **ADVANCED tab**</span>

<span class="sd">    - [`getBrandName`](#method-getBrandName)/[`setBrandName`](#method-setBrandName)</span>
<span class="sd">    - [`getSimpleUiMode`](#method-getSimpleUiMode)/[`setSimpleUiMode`](#method-setSimpleUiMode)</span>
<span class="sd">    - [`getLearningUiMode`](#method-getLearningUiMode)/[`setLearningUiMode`](#method-setLearningUiMode)</span>

<span class="sd">    **GLOBAL CONTROLS**</span>

<span class="sd">    - [`getBrightnessSlider`](#method-getBrightnessSlider)/[`setBrightnessSlider`](#method-setBrightnessSlider)</span>

<span class="sd">    **LOW-LEVEL SEND/RECEIVE**</span>

<span class="sd">    - [`wsReceive`](#method-wsreceive)</span>
<span class="sd">    - [`wsSendJson`](#method-wssendjson)</span>
<span class="sd">    - [`wsSendBinary`](#method-wssendbinary)</span>

<span class="sd">    **FILESYSTEM**</span>

<span class="sd">    - [`getFileList`](#method-getfilelist)</span>
<span class="sd">    - [`getFile`](#method-getfile)/[`putFile`](#method-putfile)/[`deleteFile`](#method-deletefile)</span>

<span class="sd">    **STATISTICS**</span>

<span class="sd">    - [`getStatistics`](#method-getStatistics)</span>
<span class="sd">    - [`getFPS`](#method-getFPS)</span>
<span class="sd">    - [`getUptime`](#method-getUptime)</span>
<span class="sd">    - [`getStorageSize`](#method-getStorageSize)</span>
<span class="sd">    - [`getStorageUsed`](#method-getStorageUsed)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># --- PRIVATE DATA</span>
    <span class="n">default_recv_timeout</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ws</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">ipAddress</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">proxyUrl</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">proxyDict</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Pattern cache</span>
    <span class="n">cacheRefreshTime</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">cacheRefreshInterval</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c1"># milliseconds used internally</span>
    <span class="n">patternCache</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Parser state cache</span>
    <span class="n">latestStats</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">latestSequencer</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">latestExpander</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">latestVersion</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">latestUpdateCheck</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">connectionBroken</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># --- OBJECT LIFETIME MANAGEMENT (CREATION/DELETION)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ipAddress</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">proxyUrl</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes an object for communicating with and controlling a Pixelblaze.</span>

<span class="sd">        Args:</span>
<span class="sd">            ipAddress (str): The Pixelblaze&#39;s IPv4 address in the usual dotted-quads numeric format (for example, &quot;192.168.4.1&quot;).</span>
<span class="sd">            proxyUrl (str, optional): The url of a proxy, if required, in the format &quot;protocol://ipAddress:port&quot; (for example, &quot;http://192.168.0.1:8888&quot;). Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxyUrl</span> <span class="o">=</span> <span class="n">proxyUrl</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">proxyUrl</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">proxyDict</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;http&quot;</span><span class="p">:</span> <span class="n">proxyUrl</span><span class="p">,</span> <span class="s2">&quot;https&quot;</span><span class="p">:</span> <span class="n">proxyUrl</span> <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ipAddress</span> <span class="o">=</span> <span class="n">ipAddress</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_open</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setCacheRefreshTime</span><span class="p">(</span><span class="mi">600</span><span class="p">)</span>  <span class="c1"># seconds used in public api</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.__enter__"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.__enter__" href="../../pixelblaze/#pixelblaze.Pixelblaze.__enter__">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Internal class method for resource management.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Pixelblaze: This object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.__exit__"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.__exit__" href="../../pixelblaze/#pixelblaze.Pixelblaze.__exit__">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Internal class method for resource management.</span>

<span class="sd">        Args:</span>
<span class="sd">            exc_type (_type_): As per Python standard.</span>
<span class="sd">            exc_value (_type_): As per Python standard.</span>
<span class="sd">            traceback (_type_): As per Python standard.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Make sure we clean up after ourselves.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_close</span><span class="p">()</span>

    <span class="c1"># --- STATIC METHODS</span>

    <span class="k">class</span> <span class="nc">LightweightEnumerator</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.LightweightEnumerator"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.LightweightEnumerator" href="../../pixelblaze/#pixelblaze.Pixelblaze.LightweightEnumerator">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Internal implementation class for the [`EnumerateAddresses`](#method-enumerateaddresses) and [`EnumerateDevices`](#method-enumeratedevices) methods.&quot;&quot;&quot;</span>

        <span class="c1"># Enumerated type for the type of the Enumerator.</span>
        <span class="k">class</span> <span class="nc">EnumeratorTypes</span><span class="p">(</span><span class="n">IntEnum</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.LightweightEnumerator.EnumeratorTypes"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.LightweightEnumerator.EnumeratorTypes" href="../../pixelblaze/#pixelblaze.Pixelblaze.LightweightEnumerator.EnumeratorTypes">DOCS</a>
            <span class="sd">&quot;&quot;&quot;Enumerator to specify the desired LightweightEnumerator type.&quot;&quot;&quot;</span>
            <span class="n">noType</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Not used</span>
            <span class="n">ipAddress</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># An enumerator that returns the IP Address of any Pixelblazes found.</span>
            <span class="n">pixelblazeObject</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># An enumerator that returns a Pixelblaze object for any Pixelblazes found.</span>

        <span class="c1"># Members:</span>
        <span class="n">listenSocket</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">timeStop</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">seenPixelblazes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">enumeratorType</span> <span class="o">=</span> <span class="n">EnumeratorTypes</span><span class="o">.</span><span class="n">noType</span>
        <span class="n">proxyUrl</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># private constructor:</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enumeratorType</span><span class="p">:</span><span class="n">EnumeratorTypes</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">1500</span><span class="p">,</span> <span class="n">proxyUrl</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hostIP</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;0.0.0.0&quot;</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;    </span>
<span class="sd">            Create an interable object that listens for Pixelblaze beacon packets, returning a Pixelblaze object for each unique beacon seen during the timeout period.</span>

<span class="sd">            Args:</span>
<span class="sd">                enumeratorType (EnumeratorTypes): Which of the available enumerator types to create.</span>
<span class="sd">                hostIP (str, optional): The network interface on which to listen for Pixelblazes. Defaults to &quot;0.0.0.0&quot; meaning all available interfaces.</span>
<span class="sd">                timeout (int, optional): The amount of time in milliseconds to listen for a new Pixelblaze to announce itself (They announce themselves once per second). Defaults to 1500.</span>
<span class="sd">                proxyUrl (str, optional): The url of a proxy, if required, in the format &quot;protocol://ipAddress:port&quot; (for example, &quot;http://192.168.0.1:8888&quot;). Defaults to None.</span>

<span class="sd">            Note:</span>
<span class="sd">                This method is not intended to be called directly; use the static methods [`EnumerateAddresses`](#method-enumerateaddresses) or [`EnumerateDevices`](#method-enumeratedevices) to create and return an iterator object.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">enumeratorType</span> <span class="o">=</span> <span class="n">enumeratorType</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">proxyUrl</span> <span class="o">=</span> <span class="n">proxyUrl</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">listenSocket</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">listenSocket</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">listenSocket</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="n">hostIP</span><span class="p">,</span> <span class="mi">1889</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.LightweightEnumerator.__del__"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.LightweightEnumerator.__del__" href="../../pixelblaze/#pixelblaze.Pixelblaze.LightweightEnumerator.__del__">DOCS</a>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Stop listening for datagrams, terminate listener thread and close socket.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">listenSocket</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">listenSocket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c1"># Return __iter__ object.</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.LightweightEnumerator.__next__"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.LightweightEnumerator.__next__" href="../../pixelblaze/#pixelblaze.Pixelblaze.LightweightEnumerator.__next__">DOCS</a>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Return the next Pixelblaze found, until the timeout expires.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># If we receive a beacon packet from a new Pixelblaze, return an object for it.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timeStop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_in_millis</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_in_millis</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeStop</span><span class="p">:</span>
                <span class="n">data</span><span class="p">,</span> <span class="n">ipAddress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listenSocket</span><span class="o">.</span><span class="n">recvfrom</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
                <span class="n">pkt</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;LLL&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pkt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">42</span><span class="p">:</span> <span class="c1"># beacon packet</span>
                    <span class="k">if</span> <span class="n">ipAddress</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seenPixelblazes</span><span class="p">:</span>
                        <span class="c1"># Add this address to our list so we don&#39;t repeat it.</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">seenPixelblazes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ipAddress</span><span class="p">)</span>
                        <span class="c1"># Return an enumerator of the appropriate type.</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enumeratorType</span> <span class="o">==</span> <span class="n">Pixelblaze</span><span class="o">.</span><span class="n">LightweightEnumerator</span><span class="o">.</span><span class="n">EnumeratorTypes</span><span class="o">.</span><span class="n">ipAddress</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">ipAddress</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">enumeratorType</span> <span class="o">==</span> <span class="n">Pixelblaze</span><span class="o">.</span><span class="n">LightweightEnumerator</span><span class="o">.</span><span class="n">EnumeratorTypes</span><span class="o">.</span><span class="n">pixelblazeObject</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">Pixelblaze</span><span class="p">(</span><span class="n">ipAddress</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">proxyUrl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">proxyUrl</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span> 
                            <span class="c1"># No such type...How did that happen?</span>
                            <span class="k">raise</span>

            <span class="c1"># Exit because the timeout has expired.</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>

        <span class="k">def</span> <span class="nf">_time_in_millis</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Utility Method: Returns last 32 bits of the current time in milliseconds</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span> <span class="o">%</span> <span class="mh">0xFFFFFFFF</span>

    <span class="c1"># Static methods:</span>
    <span class="nd">@staticmethod</span><span id="pixelblaze.Pixelblaze.EnumerateAddresses"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.EnumerateAddresses" href="../../pixelblaze/#pixelblaze.Pixelblaze.EnumerateAddresses">DOCS</a>
    <span class="k">def</span> <span class="nf">EnumerateAddresses</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">1500</span><span class="p">,</span> <span class="n">proxyUrl</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hostIP</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;0.0.0.0&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LightweightEnumerator</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns an enumerator that will iterate through all the Pixelblazes on the local network, until {timeout} milliseconds have passed with no new devices appearing.</span>

<span class="sd">        Args:</span>
<span class="sd">            hostIP (str, optional): The network interface on which to listen for Pixelblazes. Defaults to &quot;0.0.0.0&quot; meaning all available interfaces.</span>
<span class="sd">            timeout (int, optional): The amount of time in milliseconds to listen for a new Pixelblaze to announce itself (They announce themselves once per second). Defaults to 1500.</span>
<span class="sd">            proxyUrl (str, optional): The url of a proxy, if required, in the format &quot;protocol://ipAddress:port&quot; (for example, &quot;http://192.168.0.1:8888&quot;). Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            LightweightEnumerator: A subclassed Python enumerator object that returns (as a string) the IPv4 address of a Pixelblaze, in the usual dotted-quads numeric format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Pixelblaze</span><span class="o">.</span><span class="n">LightweightEnumerator</span><span class="p">(</span><span class="n">Pixelblaze</span><span class="o">.</span><span class="n">LightweightEnumerator</span><span class="o">.</span><span class="n">EnumeratorTypes</span><span class="o">.</span><span class="n">ipAddress</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span> <span class="n">proxyUrl</span><span class="o">=</span><span class="n">proxyUrl</span><span class="p">,</span> <span class="n">hostIP</span><span class="o">=</span><span class="n">hostIP</span><span class="p">)</span>

    <span class="nd">@staticmethod</span><span id="pixelblaze.Pixelblaze.EnumerateDevices"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.EnumerateDevices" href="../../pixelblaze/#pixelblaze.Pixelblaze.EnumerateDevices">DOCS</a>
    <span class="k">def</span> <span class="nf">EnumerateDevices</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">1500</span><span class="p">,</span> <span class="n">proxyUrl</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hostIP</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;0.0.0.0&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LightweightEnumerator</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns an enumerator that will iterate through all the Pixelblazes on the local network, until {timeout} milliseconds have passed with no new devices appearing.</span>

<span class="sd">        Args:</span>
<span class="sd">            hostIP (str, optional): The network interface on which to listen for Pixelblazes. Defaults to &quot;0.0.0.0&quot; meaning all available interfaces.</span>
<span class="sd">            timeout (int, optional): The amount of time in milliseconds to listen for a new Pixelblaze to announce itself (They announce themselves once per second). Defaults to 1500.</span>
<span class="sd">            proxyUrl (str, optional): The url of a proxy, if required, in the format &quot;protocol://ipAddress:port&quot; (for example, &quot;http://192.168.0.1:8888&quot;). Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            LightweightEnumerator: A subclassed Python enumerator object that returns a Pixelblaze object for controlling a discovered Pixelblaze.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Pixelblaze</span><span class="o">.</span><span class="n">LightweightEnumerator</span><span class="p">(</span><span class="n">Pixelblaze</span><span class="o">.</span><span class="n">LightweightEnumerator</span><span class="o">.</span><span class="n">EnumeratorTypes</span><span class="o">.</span><span class="n">pixelblazeObject</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span> <span class="n">proxyUrl</span><span class="o">=</span><span class="n">proxyUrl</span><span class="p">,</span> <span class="n">hostIP</span><span class="o">=</span><span class="n">hostIP</span><span class="p">)</span>

    <span class="c1"># --- CONNECTION MANAGEMENT</span>

    <span class="k">def</span> <span class="nf">_open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens a websocket connection to the Pixelblaze.</span>

<span class="sd">        This is called automatically when a Pixelblaze object is created; it is not necessary to explicitly </span>
<span class="sd">        call open to connect unless the websocket has been explicitly closed by the user previously.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;ws://&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ipAddress</span> <span class="o">+</span> <span class="s2">&quot;:81&quot;</span>
            <span class="n">retryCount</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxyUrl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proxyUrl</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="n">websocket</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">sockopt</span><span class="o">=</span><span class="p">((</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">IPPROTO_TCP</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">TCP_NODELAY</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">proxy_type</span><span class="o">=</span><span class="n">url</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span> <span class="n">http_proxy_host</span><span class="o">=</span><span class="n">url</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span> <span class="n">http_proxy_port</span><span class="o">=</span><span class="n">url</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="n">websocket</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">sockopt</span><span class="o">=</span><span class="p">((</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">IPPROTO_TCP</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">TCP_NODELAY</span><span class="p">,</span> <span class="mi">1</span><span class="p">),))</span>
                    <span class="k">break</span>
                <span class="k">except</span> <span class="n">websocket</span><span class="o">.</span><span class="n">_exceptions</span><span class="o">.</span><span class="n">WebSocketConnectionClosedException</span><span class="p">:</span>
                    <span class="n">retryCount</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">retryCount</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="k">raise</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_recv_timeout</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># Reset our caches so we&#39;ll get them afresh.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">latestStats</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">latestUpdateCheck</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">latestVersion</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">latestSequencer</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">latestExpander</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Close websocket connection.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># --- LOW-LEVEL SEND/RECEIVE</span>

    <span class="k">class</span> <span class="nc">messageTypes</span><span class="p">(</span><span class="n">IntEnum</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.messageTypes"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.messageTypes" href="../../pixelblaze/#pixelblaze.Pixelblaze.messageTypes">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Types of binary messages sent and received by a Pixelblaze.  The first byte of a binary frame contains the message type.&quot;&quot;&quot;</span>
        <span class="n">putSourceCode</span> <span class="o">=</span> <span class="mi">1</span>       <span class="c1"># from client to PB</span>
        <span class="n">putByteCode</span> <span class="o">=</span> <span class="mi">3</span>         <span class="c1"># from client to PB</span>
        <span class="n">previewImage</span> <span class="o">=</span> <span class="mi">4</span>        <span class="c1"># from client to PB</span>
        <span class="n">previewFrame</span> <span class="o">=</span> <span class="mi">5</span>        <span class="c1"># from PB to client</span>
        <span class="n">getSourceCode</span> <span class="o">=</span> <span class="mi">6</span>       <span class="c1"># from PB to client</span>
        <span class="n">getProgramList</span> <span class="o">=</span> <span class="mi">7</span>      <span class="c1"># from client to PB</span>
        <span class="n">putPixelMap</span> <span class="o">=</span> <span class="mi">8</span>         <span class="c1"># from client to PB</span>
        <span class="n">ExpanderConfig</span> <span class="o">=</span> <span class="mi">9</span>      <span class="c1"># from client to PB *and* PB to client</span>

    <span class="k">class</span> <span class="nc">frameTypes</span><span class="p">(</span><span class="n">Flag</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.frameTypes"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.frameTypes" href="../../pixelblaze/#pixelblaze.Pixelblaze.frameTypes">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Continuation flags for messages sent and received by a Pixelblaze.  The second byte of a binary frame tells whether this packet is part of a set.&quot;&quot;&quot;</span>
        <span class="n">frameNone</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">frameFirst</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">frameMiddle</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">frameLast</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="k">def</span> <span class="nf">wsReceive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">binaryMessageType</span><span class="p">:</span><span class="n">messageTypes</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span><span id="pixelblaze.Pixelblaze.wsReceive"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.wsReceive" href="../../pixelblaze/#pixelblaze.Pixelblaze.wsReceive">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Wait for a message of a particular type from the Pixelblaze.</span>

<span class="sd">        Args:</span>
<span class="sd">            binaryMessageType (messageTypes, optional): The type of binary message to wait for (if None, waits for a text message). Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[str, bytes, None]: The message received from the Pixelblaze (of type bytes for binaryMessageTypes, otherwise of type str), or None if a timeout occurred.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">startTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_in_millis</span><span class="p">()</span>
        <span class="c1"># loop until we have all the packets we want or we hit timeout.</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                    <span class="c1"># Some frames are sent unrequested and often interrupt the conversation; we&#39;ll just</span>
                    <span class="c1"># just save the most recent one and retrieve it later when we want it.</span>
                    <span class="k">if</span> <span class="n">frame</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;{&quot;fps&quot;:&#39;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">latestStats</span> <span class="o">=</span> <span class="n">frame</span>
                    <span class="k">elif</span> <span class="n">frame</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;{&quot;activeProgram&quot;:&#39;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">latestSequencer</span> <span class="o">=</span> <span class="n">frame</span>
                    <span class="c1"># We wanted a text frame, we got a text frame.</span>
                    <span class="k">elif</span> <span class="n">binaryMessageType</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
                        <span class="k">return</span> <span class="n">frame</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">frameType</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">frameType</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">messageTypes</span><span class="o">.</span><span class="n">previewFrame</span><span class="o">.</span><span class="n">value</span><span class="p">:</span> 
                        <span class="c1"># This packet type doesn&#39;t have frameType flags.</span>
                        <span class="k">if</span> <span class="n">binaryMessageType</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">messageTypes</span><span class="o">.</span><span class="n">previewFrame</span><span class="p">:</span> <span class="k">return</span> <span class="n">frame</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> 
                        <span class="k">else</span><span class="p">:</span> <span class="k">continue</span> <span class="c1"># We weren&#39;t looking for a preview frame, so ignore it.</span>

                    <span class="c1"># Check the flags to see if we need to read more packets.</span>
                    <span class="n">frameFlags</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">message</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">frameFlags</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">frameTypes</span><span class="o">.</span><span class="n">frameFirst</span><span class="o">.</span><span class="n">value</span><span class="p">):</span> <span class="k">raise</span> <span class="c1"># The first frame must be a start frame</span>
                    <span class="k">if</span> <span class="n">message</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">frameFlags</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">frameTypes</span><span class="o">.</span><span class="n">frameFirst</span><span class="o">.</span><span class="n">value</span><span class="p">):</span> <span class="k">raise</span> <span class="c1"># We shouldn&#39;t get a start frame after we&#39;ve started</span>
                    <span class="k">if</span> <span class="n">message</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">message</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="c1"># Start with the first packet...</span>
                    <span class="k">else</span><span class="p">:</span> <span class="n">message</span> <span class="o">+=</span> <span class="n">frame</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="c1">#...and append the rest until we reach the end.</span>

                    <span class="c1"># If we&#39;ve received all the packets, deal with the message.</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">frameFlags</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">frameTypes</span><span class="o">.</span><span class="n">frameLast</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
                        <span class="c1"># Expander config frames are ONLY sent during a config request, but they sometimes arrive</span>
                        <span class="c1"># out of order so we&#39;ll save them and retrieve them separately.</span>
                        <span class="k">if</span> <span class="n">frameType</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">messageTypes</span><span class="o">.</span><span class="n">ExpanderConfig</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">latestExpander</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__decodeExpanderData</span><span class="p">(</span><span class="n">frame</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
                            <span class="k">continue</span>
                        <span class="k">if</span> <span class="n">frameType</span> <span class="o">!=</span> <span class="n">binaryMessageType</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;got unwanted binary frame type </span><span class="si">{</span><span class="n">frameType</span><span class="si">}</span><span class="s2"> (wanted </span><span class="si">{</span><span class="n">binaryMessageType</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                            <span class="k">continue</span> <span class="c1"># skip this unwanted binary frame (which shouldn&#39;t really happen anyway)</span>
                        <span class="k">return</span> <span class="n">message</span>

            <span class="k">except</span> <span class="n">websocket</span><span class="o">.</span><span class="n">_exceptions</span><span class="o">.</span><span class="n">WebSocketTimeoutException</span><span class="p">:</span> <span class="c1"># timeout -- we can just ignore this</span>
                <span class="n">endTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_in_millis</span><span class="p">()</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">endTime</span> <span class="o">-</span> <span class="n">startTime</span><span class="p">)</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_recv_timeout</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">None</span>

            <span class="k">except</span> <span class="n">websocket</span><span class="o">.</span><span class="n">_exceptions</span><span class="o">.</span><span class="n">WebSocketConnectionClosedException</span><span class="p">:</span> <span class="c1"># try reopening</span>
                <span class="c1">#print(&quot;wsReceive reconnection&quot;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connectionBroken</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_open</span><span class="p">()</span>

            <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  
                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="n">errno</span><span class="o">.</span><span class="n">EPIPE</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connectionBroken</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_close</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_open</span><span class="p">()</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connectionBroken</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;wsReceive: unknown exception: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">raise</span>

    <span class="k">def</span> <span class="nf">sendPing</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span><span id="pixelblaze.Pixelblaze.sendPing"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.sendPing" href="../../pixelblaze/#pixelblaze.Pixelblaze.sendPing">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Send a Ping message to the Pixelblaze and wait for the Acknowledgement response.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[str, None]: The acknowledgement message received from the Pixelblaze, or None if a timeout occurred.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;ping&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="s2">&quot;ack&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">wsSendJson</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span><span id="pixelblaze.Pixelblaze.wsSendJson"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.wsSendJson" href="../../pixelblaze/#pixelblaze.Pixelblaze.wsSendJson">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Send a JSON-formatted command to the Pixelblaze, and optionally wait for a suitable response.</span>

<span class="sd">        Args:</span>
<span class="sd">            command (dict): A Python dictionary which will be sent to the Pixelblaze as a JSON command.</span>
<span class="sd">            expectedResponse (str, optional): If present, the initial key of the expected JSON response to the command. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[str, bytes, None]: The message received from the Pixelblaze (of type bytes for binaryMessageTypes, otherwise of type str), or None if a timeout occurred.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connectionBroken</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_open</span><span class="p">()</span> <span class="c1"># make sure it&#39;s open, even if it closed while we were doing other things.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">expectedResponse</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
                    <span class="k">return</span> <span class="kc">None</span>

                <span class="c1"># If the pipe broke while we were sending, restart from the beginning.</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectionBroken</span><span class="p">:</span> <span class="k">break</span>

                <span class="c1"># Wait for the expected response.</span>
                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="c1"># Loop until we get the right text response.</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">expectedResponse</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsReceive</span><span class="p">(</span><span class="n">binaryMessageType</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">break</span>
                        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">{{</span><span class="s1">&quot;</span><span class="si">{</span><span class="n">expectedResponse</span><span class="si">}</span><span class="s1">&quot;:&#39;</span><span class="p">):</span> <span class="k">break</span>
                    <span class="c1"># Or the right binary response.</span>
                    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">expectedResponse</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">messageTypes</span><span class="p">:</span>
                        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsReceive</span><span class="p">(</span><span class="n">binaryMessageType</span><span class="o">=</span><span class="n">expectedResponse</span><span class="p">)</span>
                        <span class="k">break</span>
                <span class="c1"># Now that we&#39;ve got the right response, return it.</span>
                <span class="k">return</span> <span class="n">response</span>

            <span class="k">except</span> <span class="n">websocket</span><span class="o">.</span><span class="n">_exceptions</span><span class="o">.</span><span class="n">WebSocketConnectionClosedException</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connectionBroken</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_open</span><span class="p">()</span>   <span class="c1"># try reopening</span>

            <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  
                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="n">errno</span><span class="o">.</span><span class="n">EPIPE</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connectionBroken</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_close</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_open</span><span class="p">()</span>

            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connectionBroken</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_open</span><span class="p">()</span>   <span class="c1"># try reopening</span>
                <span class="c1">#raise</span>

    <span class="k">def</span> <span class="nf">wsSendBinary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">binaryMessageType</span><span class="p">:</span><span class="n">messageTypes</span><span class="p">,</span> <span class="n">blob</span><span class="p">:</span><span class="nb">bytes</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">expectedResponse</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.wsSendBinary"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.wsSendBinary" href="../../pixelblaze/#pixelblaze.Pixelblaze.wsSendBinary">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Send a binary command to the Pixelblaze, and optionally wait for a suitable response.</span>

<span class="sd">        Args:</span>
<span class="sd">            binaryMessageType (messageTypes, optional): The type of binary message to send.</span>
<span class="sd">            blob (bytes): The message body to be sent.</span>
<span class="sd">            expectedResponse (str, optional): If present, the initial key of the expected JSON response to the command. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            response: The message received from the Pixelblaze (of type bytes for binaryMessageTypes, otherwise of type str), or None if a timeout occurred.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connectionBroken</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Break the frame into manageable chunks.</span>
                <span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">maxFrameSize</span> <span class="o">=</span> <span class="mi">8192</span>
                <span class="k">if</span> <span class="n">binaryMessageType</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">messageTypes</span><span class="o">.</span><span class="n">putByteCode</span><span class="p">:</span> <span class="n">maxFrameSize</span> <span class="o">=</span> <span class="mi">1280</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">blob</span><span class="p">),</span> <span class="n">maxFrameSize</span><span class="p">):</span>

                    <span class="c1"># Set the frame header values.</span>
                    <span class="n">frameHeader</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">frameHeader</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">binaryMessageType</span><span class="o">.</span><span class="n">value</span>
                    <span class="n">frameFlag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frameTypes</span><span class="o">.</span><span class="n">frameNone</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">frameFlag</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frameTypes</span><span class="o">.</span><span class="n">frameFirst</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">maxFrameSize</span><span class="p">:</span> <span class="n">frameFlag</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frameTypes</span><span class="o">.</span><span class="n">frameLast</span>
                    <span class="k">else</span><span class="p">:</span> <span class="n">frameFlag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frameTypes</span><span class="o">.</span><span class="n">frameMiddle</span>
                    <span class="n">frameHeader</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">frameFlag</span><span class="o">.</span><span class="n">value</span>

                    <span class="c1"># Send the packet.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">send_binary</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">frameHeader</span><span class="p">)</span> <span class="o">+</span> <span class="n">blob</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">maxFrameSize</span><span class="p">])</span>

                    <span class="c1"># If the pipe broke while we were sending, restart from the beginning.</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectionBroken</span><span class="p">:</span> <span class="k">break</span>

                    <span class="c1"># Wait for the expected response.</span>
                    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="c1"># Loop until we get the right text response.</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">expectedResponse</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsReceive</span><span class="p">(</span><span class="n">binaryMessageType</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">break</span>
                            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">expectedResponse</span><span class="p">):</span> <span class="k">break</span>
                        <span class="c1"># Or the right binary response.</span>
                        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">expectedResponse</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">messageTypes</span><span class="p">:</span>
                            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsReceive</span><span class="p">(</span><span class="n">binaryMessageType</span><span class="o">=</span><span class="n">expectedResponse</span><span class="p">)</span>
                            <span class="k">break</span>
                <span class="c1"># Now that we&#39;ve sent all the chunks, return the last status received.</span>
                <span class="k">return</span> <span class="n">response</span>

            <span class="k">except</span> <span class="n">websocket</span><span class="o">.</span><span class="n">_exceptions</span><span class="o">.</span><span class="n">WebSocketConnectionClosedException</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;wsSendBinary reconnection&quot;</span><span class="p">)</span>
                <span class="c1"># try reopening</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connectionBroken</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_open</span><span class="p">()</span>

            <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  
                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="n">errno</span><span class="o">.</span><span class="n">EPIPE</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connectionBroken</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_close</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_open</span><span class="p">()</span>

            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;wsSendBinary received unexpected exception&quot;</span><span class="p">)</span>
                <span class="c1"># try reopening</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connectionBroken</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_open</span><span class="p">()</span>
                <span class="c1">#raise</span>

    <span class="k">def</span> <span class="nf">getPeers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.getPeers"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getPeers" href="../../pixelblaze/#pixelblaze.Pixelblaze.getPeers">DOCS</a>
        <span class="sd">&quot;&quot;&quot;A new command, added to the API but not yet implemented as of v2.29/v3.24, that will return a list of all the Pixelblazes visible on the local network segment.</span>

<span class="sd">        Returns:</span>
<span class="sd">            TBD: To be defined once @wizard implements the function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;getPeers&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsReceive</span><span class="p">(</span><span class="n">binaryMessageType</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># --- PIXELBLAZE FILESYSTEM FUNCTIONS:</span>

    <span class="k">def</span> <span class="nf">getUrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getUrl"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getUrl" href="../../pixelblaze/#pixelblaze.Pixelblaze.getUrl">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Build the URL to communicate with the Pixelblaze using an HTTP endpoint.</span>

<span class="sd">        Args:</span>
<span class="sd">            endpoint (str, optional): The HTTP endpoint. Defaults to None, which returns the URL of the Pixelblaze webUI.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The URL of the HTTP endpoint on the Pixelblaze.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">urljoin</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;http://</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ipAddress</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">fileTypes</span><span class="p">(</span><span class="n">IntFlag</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.fileTypes"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.fileTypes" href="../../pixelblaze/#pixelblaze.Pixelblaze.fileTypes">DOCS</a>
        <span class="sd">&quot;&quot;&quot;A Pixelblaze contains Patterns, PatternSettings, Configs, Playlists, System and Other types of files.&quot;&quot;&quot;</span>
        <span class="n">fileConfig</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">filePattern</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">filePatternSetting</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">filePlaylist</span> <span class="o">=</span> <span class="mi">8</span>
        <span class="n">fileSystem</span> <span class="o">=</span> <span class="mi">16</span>
        <span class="n">fileOther</span> <span class="o">=</span> <span class="mi">32</span>
        <span class="n">fileAll</span> <span class="o">=</span> <span class="n">fileConfig</span> <span class="o">|</span> <span class="n">filePattern</span> <span class="o">|</span> <span class="n">filePatternSetting</span> <span class="o">|</span> <span class="n">filePlaylist</span> <span class="o">|</span> <span class="n">fileSystem</span> <span class="o">|</span> <span class="n">fileOther</span>

    <span class="k">def</span> <span class="nf">getFileList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileTypes</span><span class="p">:</span><span class="n">fileTypes</span><span class="o">=</span><span class="n">fileTypes</span><span class="o">.</span><span class="n">fileAll</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span><span id="pixelblaze.Pixelblaze.getFileList"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getFileList" href="../../pixelblaze/#pixelblaze.Pixelblaze.getFileList">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns a list of all the files of a particular type stored on the Pixelblaze&#39;s filesystem.</span>

<span class="sd">        For Pixelblazes running firmware versions lower than 2.29/3.24 (the point at which </span>
<span class="sd">        the necessary API was introduced), the list includes the names of optional configuration </span>
<span class="sd">        files that may or may not exist on a particular Pixelblaze, depending on its setup.</span>

<span class="sd">        Args:</span>
<span class="sd">            fileTypes (fileTypes, optional): A bitmasked enumeration of the fileTypes to be listed. Defaults to fileTypes.fileAll.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[str]: A list of filenames of the requested fileType.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fileList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getUrl</span><span class="p">(</span><span class="s2">&quot;list&quot;</span><span class="p">),</span> <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">proxyDict</span><span class="p">)</span> <span class="k">as</span> <span class="n">rList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rList</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">rList</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span> 
                    <span class="n">fileName</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># &#39;/list&#39; returns a number of lines, each containing [filename][tab][size][newline]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">fileList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span> <span class="c1"># &#39;/list&#39; returns a blank line at the end.</span>
            <span class="k">elif</span> <span class="n">rList</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
                <span class="c1"># If the Pixelblaze doesn&#39;t support the &quot;/list&quot; endpoint, get the patternList using WebSocket calls.</span>
                <span class="n">fileList</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">fileName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPatternList</span><span class="p">():</span>
                    <span class="n">fileList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/p/</span><span class="si">{</span><span class="n">fileName</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>    <span class="c1"># the pattern blob</span>
                    <span class="n">fileList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/p/</span><span class="si">{</span><span class="n">fileName</span><span class="si">}</span><span class="s2">.c&quot;</span><span class="p">)</span>  <span class="c1"># the current value of any (optional) UI controls</span>
                <span class="c1"># Append the names of all the other files a Pixelblaze might contain, some of which may not exist on any particular device.</span>
                <span class="k">for</span> <span class="n">fileName</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;apple-touch-icon.png&quot;</span><span class="p">,</span> <span class="s2">&quot;favicon.ico&quot;</span><span class="p">,</span> <span class="s2">&quot;config.json&quot;</span><span class="p">,</span> <span class="s2">&quot;obconf.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;pixelmap.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;pixelmap.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;l/_defaultplaylist_&quot;</span><span class="p">]:</span>
                    <span class="n">fileList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">fileName</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">rList</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Filter the list depending on the fileTypes requested.</span>
        <span class="k">for</span> <span class="n">fileName</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fileList</span><span class="p">):</span>
            <span class="c1"># fileConfigs:</span>
            <span class="k">if</span> <span class="n">fileName</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;config.json&quot;</span><span class="p">,</span> <span class="s2">&quot;config2.json&quot;</span><span class="p">,</span> <span class="s2">&quot;obconf.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;pixelmap.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;pixelmap.dat&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">fileTypes</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileTypes</span><span class="o">.</span><span class="n">fileConfig</span><span class="p">):</span>
                    <span class="n">fileList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
            <span class="c1"># filePatterns and filePatternSettings:</span>
            <span class="k">elif</span> <span class="n">fileName</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;/p/&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">fileName</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.c&quot;</span><span class="p">):</span>
                    <span class="c1"># filePatternSettings:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">fileTypes</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileTypes</span><span class="o">.</span><span class="n">filePatternSetting</span><span class="p">):</span>
                        <span class="n">fileList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># filePattern:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">fileTypes</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileTypes</span><span class="o">.</span><span class="n">filePattern</span><span class="p">):</span>
                        <span class="n">fileList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
            <span class="c1"># filePlaylists:</span>
            <span class="k">elif</span> <span class="n">fileName</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;/l/&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">fileTypes</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileTypes</span><span class="o">.</span><span class="n">filePlaylist</span><span class="p">):</span>
                    <span class="n">fileList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
            <span class="c1"># fileSystem:</span>
            <span class="k">elif</span> <span class="n">fileName</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.gz&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">fileTypes</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileTypes</span><span class="o">.</span><span class="n">fileSystem</span><span class="p">):</span>
                    <span class="n">fileList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
            <span class="c1"># fileOthers:</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Ignore the blank line returned by the &#39;/list&#39; endpoint.</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">fileTypes</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileTypes</span><span class="o">.</span><span class="n">fileOther</span><span class="p">):</span>
                    <span class="n">fileList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>

        <span class="c1"># Return the filtered list.</span>
        <span class="n">fileList</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fileList</span>

    <span class="k">def</span> <span class="nf">getFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getFile"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getFile" href="../../pixelblaze/#pixelblaze.Pixelblaze.getFile">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Downloads a file from the Pixelblaze using the HTTP API.</span>

<span class="sd">        Args:</span>
<span class="sd">            fileName (str): The pathname (as returned from `getFileList`) of the file to be downloaded.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bytes: The contents of the file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getUrl</span><span class="p">(</span><span class="n">fileName</span><span class="p">),</span> <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">proxyDict</span><span class="p">)</span> <span class="k">as</span> <span class="n">rGet</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rGet</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">404</span><span class="p">]:</span>
                <span class="n">rGet</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">rGet</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">rGet</span><span class="o">.</span><span class="n">content</span>

    <span class="k">def</span> <span class="nf">putFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">fileContents</span><span class="p">:</span><span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.putFile"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.putFile" href="../../pixelblaze/#pixelblaze.Pixelblaze.putFile">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Uploads a file to the Pixelblaze using the HTTP API.</span>

<span class="sd">        Args:</span>
<span class="sd">            fileName (str): The pathname at which to store the file.</span>
<span class="sd">            fileContents (bytes): The data to store in the file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the file was successfully stored; False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fileData</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">fileContents</span><span class="p">)}</span>
        <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getUrl</span><span class="p">(</span><span class="s2">&quot;edit&quot;</span><span class="p">),</span> <span class="n">files</span><span class="o">=</span><span class="n">fileData</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">proxyDict</span><span class="p">)</span> <span class="k">as</span> <span class="n">rPost</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rPost</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">rPost</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">deleteFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.deleteFile"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.deleteFile" href="../../pixelblaze/#pixelblaze.Pixelblaze.deleteFile">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Deletes a file from this Pixelblaze using the HTTP API.</span>

<span class="sd">        Args:</span>
<span class="sd">            fileName (str): The pathname (as returned from `getFileList`) of the file to be deleted.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the file was successfully stored; False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getUrl</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;delete?path=</span><span class="si">{</span><span class="n">fileName</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">proxyDict</span><span class="p">)</span> <span class="k">as</span> <span class="n">rFile</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rFile</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">404</span><span class="p">]:</span>
                <span class="n">rFile</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># --- GLOBAL functions: RENDERER STATISTICS:</span>

    <span class="k">def</span> <span class="nf">getStatistics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getStatistics"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getStatistics" href="../../pixelblaze/#pixelblaze.Pixelblaze.getStatistics">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Grab one of the statistical packets that Pixelblaze sends every second.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: the JSON message received from the Pixelblaze.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSendPreviewFrames</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Make sure the Pixelblaze will send something.</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">latestStats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latestStats</span><span class="p">)</span>
            <span class="n">ignored</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsReceive</span><span class="p">(</span><span class="n">binaryMessageType</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setSendPreviewFrames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doUpdates</span><span class="p">:</span><span class="nb">bool</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setSendPreviewFrames"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setSendPreviewFrames" href="../../pixelblaze/#pixelblaze.Pixelblaze.setSendPreviewFrames">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Set whether or not the Pixelblaze sends pattern preview frames.</span>

<span class="sd">        Args:</span>
<span class="sd">            doUpdates (bool): True sends preview frames, False stops.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">doUpdates</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span>
        <span class="k">if</span> <span class="n">doUpdates</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span> <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">messageTypes</span><span class="o">.</span><span class="n">previewFrame</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;sendUpdates&quot;</span><span class="p">:</span> <span class="n">doUpdates</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="n">response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getPreviewFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getPreviewFrame"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getPreviewFrame" href="../../pixelblaze/#pixelblaze.Pixelblaze.getPreviewFrame">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Grab one of the preview frames that Pixelblaze sends after every render cycle.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bytes: a collection of bytes representing `pixelCount` tuples containing the (R, G, B) values for each pixel in the pattern preview.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">oldTimeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">gettimeout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_recv_timeout</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsReceive</span><span class="p">(</span><span class="n">binaryMessageType</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">messageTypes</span><span class="o">.</span><span class="n">previewFrame</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="n">oldTimeout</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>

    <span class="c1"># --- GLOBAL functions: RENDERER STATISTICS: helper functions:</span>
    <span class="sd">&quot;&quot;&quot;The Pixelblaze API has functions to &#39;set&#39; individual property values, </span>
<span class="sd">    but can only &#39;get&#39; property values as part of a JSON dictionary containing all the settings</span>
<span class="sd">    on a particular UI page. These functions will extract the property value from a </span>
<span class="sd">    previously-fetched dictionary, if provided; otherwise they will fetch the settings anew.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">getFPS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">savedStatistics</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getFPS"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getFPS" href="../../pixelblaze/#pixelblaze.Pixelblaze.getFPS">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Return the speed (in Frames per Second) of the pattern rendering.</span>

<span class="sd">        Args:</span>
<span class="sd">            savedStatistics (dict, optional): If provided, extracts the value from the results of a previous call to &#39;getStatistics`; otherwise, fetches the statistics from the Pixelblaze anew.  Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: The pattern speed in FPS, as reported in a Pixelblaze statistics message.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">savedStatistics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">savedStatistics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStatistics</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">savedStatistics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fps&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getUptime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">savedStatistics</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getUptime"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getUptime" href="../../pixelblaze/#pixelblaze.Pixelblaze.getUptime">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Return the uptime (in seconds) of the Pixelblaze.</span>

<span class="sd">        Args:</span>
<span class="sd">            savedStatistics (dict, optional): If provided, extracts the value from the results of a previous call to &#39;getStatistics`; otherwise, fetches the statistics from the Pixelblaze anew.  Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: The uptime in seconds, as reported in a Pixelblaze statistics message.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">savedStatistics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">savedStatistics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStatistics</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">savedStatistics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;uptime&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getStorageUsed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">savedStatistics</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getStorageUsed"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getStorageUsed" href="../../pixelblaze/#pixelblaze.Pixelblaze.getStorageUsed">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Return the amount of Flash storage used on the Pixelblaze.</span>

<span class="sd">        Args:</span>
<span class="sd">            savedStatistics (dict, optional): If provided, extracts the value from the results of a previous call to &#39;getStatistics`; otherwise, fetches the statistics from the Pixelblaze anew.  Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: The used storage in bytes, as reported in a Pixelblaze statistics message.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">savedStatistics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">savedStatistics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStatistics</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">savedStatistics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;storageUsed&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getStorageSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">savedStatistics</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getStorageSize"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getStorageSize" href="../../pixelblaze/#pixelblaze.Pixelblaze.getStorageSize">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Return the available Flash storage on the Pixelblaze.</span>

<span class="sd">        Args:</span>
<span class="sd">            savedStatistics (dict, optional): If provided, extracts the value from the results of a previous call to &#39;getStatistics`; otherwise, fetches the statistics from the Pixelblaze anew.  Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: The available storage in bytes, as reported in a Pixelblaze statistics message.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">savedStatistics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">savedStatistics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStatistics</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">savedStatistics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;storageSize&#39;</span><span class="p">)</span>

    <span class="c1"># --- GLOBAL functions: CONTROLS (available on all tabs):</span>

    <span class="k">def</span> <span class="nf">setBrightnessSlider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">brightness</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">saveToFlash</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setBrightnessSlider"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setBrightnessSlider" href="../../pixelblaze/#pixelblaze.Pixelblaze.setBrightnessSlider">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Set the value of the UI brightness slider.</span>

<span class="sd">        Args:</span>
<span class="sd">            brightness (float): A floating-point value between 0.0 and 1.0.</span>
<span class="sd">            saveToFlash (bool, optional): If True, the setting is stored in Flash memory; otherwise the value reverts on a reboot. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;brightness&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clamp</span><span class="p">(</span><span class="n">brightness</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;save&quot;</span><span class="p">:</span> <span class="n">saveToFlash</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># --- GLOBAL functions: CONTROLS: helper functions:</span>
    <span class="sd">&quot;&quot;&quot;The Pixelblaze API has functions to &#39;set&#39; individual property values, </span>
<span class="sd">    but can only &#39;get&#39; property values as part of a JSON dictionary containing all the settings</span>
<span class="sd">    on a particular UI page. These functions will extract the property value from a </span>
<span class="sd">    previously-fetched dictionary, if provided; otherwise they will fetch the settings from the Pixelblaze anew.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">getBrightnessSlider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configSettings</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getBrightnessSlider"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getBrightnessSlider" href="../../pixelblaze/#pixelblaze.Pixelblaze.getBrightnessSlider">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Get the value of the UI brightness slider.</span>

<span class="sd">        Args:</span>
<span class="sd">            configSettings (dict, optional): If provided, extracts the value from the results of a previous call to `getConfigSettings`; otherwise, fetches the configSettings from the Pixelblaze anew. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: A floating-point value between 0.0 and 1.0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configSettings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">configSettings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfigSettings</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">configSettings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;brightness&#39;</span><span class="p">)</span>

    <span class="c1"># --- PATTERNS tab: SEQUENCER section</span>

    <span class="k">class</span> <span class="nc">sequencerModes</span><span class="p">(</span><span class="n">IntEnum</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.sequencerModes"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.sequencerModes" href="../../pixelblaze/#pixelblaze.Pixelblaze.sequencerModes">DOCS</a>
        <span class="n">Off</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ShuffleAll</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">Playlist</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">setSequencerMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sequencerMode</span><span class="p">:</span><span class="n">sequencerModes</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">saveToFlash</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setSequencerMode"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setSequencerMode" href="../../pixelblaze/#pixelblaze.Pixelblaze.setSequencerMode">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Sets the sequencer mode to one of the available sequencerModes (Off, ShuffleAll, or Playlist).</span>

<span class="sd">        Args:</span>
<span class="sd">            sequencerMode (enum): The desired sequencer mode.</span>
<span class="sd">            saveToFlash (bool, optional): If True, the setting is stored in Flash memory; otherwise the value reverts on a reboot. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;sequencerMode&quot;</span><span class="p">:</span> <span class="n">sequencerMode</span><span class="p">,</span> <span class="s2">&quot;save&quot;</span><span class="p">:</span> <span class="n">saveToFlash</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setSequencerState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sequencerState</span><span class="p">:</span><span class="nb">bool</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">saveToFlash</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setSequencerState"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setSequencerState" href="../../pixelblaze/#pixelblaze.Pixelblaze.setSequencerState">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Set the run state of the sequencer.</span>

<span class="sd">        Args:</span>
<span class="sd">            sequencerState (bool): A boolean value determining whether or not the sequencer should run.</span>
<span class="sd">            saveToFlash (bool, optional): If True, the setting is stored in Flash memory; otherwise the value reverts on a reboot. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;runSequencer&quot;</span><span class="p">:</span> <span class="n">sequencerState</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># --- PATTERNS tab: SEQUENCER section: helper functions:</span>
    <span class="sd">&quot;&quot;&quot;The Pixelblaze API has functions to &#39;set&#39; individual property values, </span>
<span class="sd">    but can only &#39;get&#39; property values as part of a JSON dictionary containing all the settings</span>
<span class="sd">    on a particular UI page. These functions will extract the property value from a </span>
<span class="sd">    previously-fetched dictionary, if provided; otherwise they will fetch the settings anew.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">getSequencerMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configSequencer</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sequencerModes</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getSequencerMode"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getSequencerMode" href="../../pixelblaze/#pixelblaze.Pixelblaze.getSequencerMode">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Gets the current sequencer mode.</span>

<span class="sd">        Args:</span>
<span class="sd">            configSequencer (dict, optional): If provided, extracts the value from the results of a previous call to `getConfigSequencer`; otherwise, fetches the configSequencer from the Pixelblaze anew. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            sequencerModes: The sequencerMode.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configSequencer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">configSequencer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfigSequencer</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">configSequencer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sequencerMode&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getSequencerState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configSequencer</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getSequencerState"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getSequencerState" href="../../pixelblaze/#pixelblaze.Pixelblaze.getSequencerState">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Gets the current sequencer run state.</span>

<span class="sd">        Args:</span>
<span class="sd">            configSequencer (dict, optional): If provided, extracts the value from the results of a previous call to `getConfigSequencer`; otherwise, fetches the configSequencer from the Pixelblaze anew. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the sequencer is running; False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configSequencer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">configSequencer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfigSequencer</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">configSequencer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;runSequencer&#39;</span><span class="p">)</span>

    <span class="c1"># --- PATTERNS tab: SEQUENCER section: SHUFFLE ALL mode</span>

    <span class="k">def</span> <span class="nf">playSequencer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">saveToFlash</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.playSequencer"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.playSequencer" href="../../pixelblaze/#pixelblaze.Pixelblaze.playSequencer">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Mimics the &#39;Play&#39; button in the UI. Starts the pattern sequencer,</span>
<span class="sd">        the consequences of which will vary depending upon the sequencerMode.</span>

<span class="sd">        Args:</span>
<span class="sd">            saveToFlash (bool, optional): If True, the setting is stored in Flash memory; otherwise the value reverts on a reboot. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSequencerState</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">saveToFlash</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pauseSequencer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">saveToFlash</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.pauseSequencer"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.pauseSequencer" href="../../pixelblaze/#pixelblaze.Pixelblaze.pauseSequencer">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Mimics the &#39;Pause&#39; button in the UI.  Pauses the pattern sequencer, </span>
<span class="sd">        without changing the current position in the shuffle or playlist. </span>
<span class="sd">        Has no effect if the sequencer is not currently running.</span>

<span class="sd">        Args:</span>
<span class="sd">            saveToFlash (bool, optional): If True, the setting is stored in Flash memory; otherwise the value reverts on a reboot. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSequencerState</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">saveToFlash</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">nextSequencer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">saveToFlash</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.nextSequencer"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.nextSequencer" href="../../pixelblaze/#pixelblaze.Pixelblaze.nextSequencer">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Mimics the &#39;Next&#39; button in the UI.  If the sequencerMode is ShuffleAll or Playlist, advances the pattern sequencer to the next pattern.</span>

<span class="sd">        Args:</span>
<span class="sd">            saveToFlash (bool, optional): If True, the setting is stored in Flash memory; otherwise the value reverts on a reboot. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;nextProgram&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;save&quot;</span><span class="p">:</span> <span class="n">saveToFlash</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setSequencerShuffleTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nMillis</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">saveToFlash</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setSequencerShuffleTime"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setSequencerShuffleTime" href="../../pixelblaze/#pixelblaze.Pixelblaze.setSequencerShuffleTime">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Sets the time the Pixelblaze&#39;s sequencer will run each pattern before switching to the next.</span>

<span class="sd">        Args:</span>
<span class="sd">            nMillis (int): The number of milliseconds to play each pattern.</span>
<span class="sd">            saveToFlash (bool, optional): If True, the setting is stored in Flash memory; otherwise the value reverts on a reboot. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;sequenceTimer&quot;</span><span class="p">:</span> <span class="n">nMillis</span><span class="p">,</span> <span class="s2">&quot;save&quot;</span><span class="p">:</span> <span class="n">saveToFlash</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># --- PATTERNS tab: SEQUENCER section: helper functions:</span>
    <span class="sd">&quot;&quot;&quot;The Pixelblaze API has functions to &#39;set&#39; individual property values, </span>
<span class="sd">    but can only &#39;get&#39; property values as part of a JSON dictionary containing all the settings</span>
<span class="sd">    on a particular UI page. These functions will extract the property value from a </span>
<span class="sd">    previously-fetched dictionary, if provided; otherwise they will fetch the settings anew.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">getSequencerShuffleTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configSequencer</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getSequencerShuffleTime"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getSequencerShuffleTime" href="../../pixelblaze/#pixelblaze.Pixelblaze.getSequencerShuffleTime">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Gets the time the Pixelblaze&#39;s sequencer will run each pattern before switching to the next.</span>

<span class="sd">        Args:</span>
<span class="sd">            configSequencer (dict, optional): If provided, extracts the value from the results of a previous call to `getConfigSequencer`; otherwise, fetches the configSequencer from the Pixelblaze anew. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: The number of milliseconds to play each pattern.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configSequencer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">configSequencer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfigSequencer</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">configSequencer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ms&quot;</span><span class="p">)</span>

    <span class="c1"># --- PATTERNS tab: SEQUENCER section: PLAYLIST mode</span>

    <span class="k">def</span> <span class="nf">getSequencerPlaylist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">playlistId</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;_defaultplaylist_&quot;</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.getSequencerPlaylist"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getSequencerPlaylist" href="../../pixelblaze/#pixelblaze.Pixelblaze.getSequencerPlaylist">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Fetches the specified playlist.  At the moment, only the default playlist is supported by the Pixelblaze.</span>

<span class="sd">        Args:</span>
<span class="sd">            playlistId (str, optional): The name of the playlist (for future enhancement; currently only &#39;_defaultplaylist_&#39; is supported). Defaults to &quot;_defaultplaylist_&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: The contents of the playlist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;getPlaylist&quot;</span><span class="p">:</span> <span class="n">playlistId</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="s2">&quot;playlist&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">setSequencerPlaylist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">playlistContents</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">playlistId</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;_defaultplaylist_&quot;</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setSequencerPlaylist"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setSequencerPlaylist" href="../../pixelblaze/#pixelblaze.Pixelblaze.setSequencerPlaylist">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Replaces the entire contents of the specified playlist.  At the moment, only the default playlist is supported by the Pixelblaze.</span>

<span class="sd">        Args:</span>
<span class="sd">            playlistContents (dict): The new playlist contents.</span>
<span class="sd">            playlistId (str, optional): The name of the playlist (for future enhancement; currently only &#39;_defaultplaylist_&#39; is supported). Defaults to &quot;_defaultplaylist_&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">latestSequencer</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># clear cache to force refresh</span>
        <span class="n">ignored</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">(</span><span class="n">playlistContents</span><span class="p">,</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">addToSequencerPlaylist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">playlistContents</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">patternId</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">duration</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.addToSequencerPlaylist"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.addToSequencerPlaylist" href="../../pixelblaze/#pixelblaze.Pixelblaze.addToSequencerPlaylist">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Appends a new entry to the specified playlist.</span>

<span class="sd">        Args:</span>
<span class="sd">            patternId (str): The patternId of the pattern to be played.</span>
<span class="sd">            duration (int): The number of milliseconds to play the pattern.</span>
<span class="sd">            playlistContents (dict): The results of a previous call to `getSequencerPlaylist`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: The updated playlist, which can then be sent back to the Pixelblaze with `setSequencerPlaylist`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">playlistContents</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;playlist&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;items&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">patternId</span><span class="p">,</span> <span class="s1">&#39;ms&#39;</span><span class="p">:</span> <span class="n">duration</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">playlistContents</span>

    <span class="c1"># --- PATTERNS tab: SAVED PATTERNS section</span>

    <span class="k">def</span> <span class="nf">getPatternList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">forceRefresh</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getPatternList"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getPatternList" href="../../pixelblaze/#pixelblaze.Pixelblaze.getPatternList">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns a list of all the patterns saved on the Pixelblaze.</span>

<span class="sd">        Normally reads from the cached pattern list, which is refreshed every 10 minutes by default. To change the cache refresh interval, call setCacheRefreshTime(seconds).</span>

<span class="sd">        Args:</span>
<span class="sd">            forceRefresh (bool, optional): Forces a refresh of the cached patternList. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary of the patterns stored on the Pixelblaze, where the patternId is the key and the patternName is the value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">forceRefresh</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_in_millis</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cacheRefreshTime</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cacheRefreshInterval</span><span class="p">):</span>
            <span class="c1"># Update the patternList cache.</span>
            <span class="n">newPatternCache</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="n">oldTimeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">gettimeout</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_recv_timeout</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;listPrograms&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">messageTypes</span><span class="o">.</span><span class="n">getProgramList</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="n">oldTimeout</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)]:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> 
                        <span class="n">newPatternCache</span><span class="p">[</span><span class="n">pattern</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">pattern</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">patternCache</span> <span class="o">=</span> <span class="n">newPatternCache</span>        
            <span class="bp">self</span><span class="o">.</span><span class="n">cacheRefreshTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_in_millis</span><span class="p">()</span>

        <span class="c1"># Return the cached list.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">patternCache</span>

    <span class="k">def</span> <span class="nf">setActivePattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patternId</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">saveToFlash</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setActivePattern"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setActivePattern" href="../../pixelblaze/#pixelblaze.Pixelblaze.setActivePattern">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Sets the active pattern.</span>

<span class="sd">        Args:</span>
<span class="sd">            patternId (str): The patternId of the desired pattern.</span>
<span class="sd">            saveToFlash (bool, optional): If True, the setting is stored in Flash memory; otherwise the value reverts on a reboot. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="sd">&quot;&quot;&quot;Functionality changed.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">patternId</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">17</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__printDeprecationMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deprecationReasons</span><span class="o">.</span><span class="n">functionalityChanged</span><span class="p">,</span> <span class="s2">&quot;setActivePattern(name_or_id)&quot;</span><span class="p">,</span> <span class="s2">&quot;setActivePattern(id)/setActivePatternByName(name&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;activeProgramId&quot;</span><span class="p">:</span> <span class="n">patternId</span><span class="p">,</span> <span class="s2">&quot;save&quot;</span><span class="p">:</span> <span class="n">saveToFlash</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="s2">&quot;activeProgram&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getPatternAsEpe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patternId</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getPatternAsEpe"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getPatternAsEpe" href="../../pixelblaze/#pixelblaze.Pixelblaze.getPatternAsEpe">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Convert a stored pattern into an exportable, portable JSON format (which then needs to be saved by the caller).</span>

<span class="sd">        Args:</span>
<span class="sd">            patternId (str): The patternId of the desired pattern.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The exported pattern as a JSON dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Request the pattern elements from the Pixelblaze and combine them into an EPE.</span>
        <span class="n">epe</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPatternList</span><span class="p">(</span><span class="n">refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">patternId</span><span class="p">,</span> <span class="s2">&quot;Unknown Pattern&quot;</span><span class="p">),</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">patternId</span><span class="p">,</span>
            <span class="s1">&#39;sources&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getPatternSourceCode</span><span class="p">(</span><span class="n">patternId</span><span class="p">)),</span>
            <span class="s1">&#39;preview&#39;</span><span class="p">:</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getPreviewImage</span><span class="p">(</span><span class="n">patternId</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">epe</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">deletePattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patternId</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.deletePattern"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.deletePattern" href="../../pixelblaze/#pixelblaze.Pixelblaze.deletePattern">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Delete a pattern saved on the Pixelblaze.</span>

<span class="sd">        Args:</span>
<span class="sd">            patternId (str): The patternId of the desired pattern.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;deleteProgram&quot;</span><span class="p">:</span> <span class="n">patternId</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getPreviewImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patternId</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getPreviewImage"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getPreviewImage" href="../../pixelblaze/#pixelblaze.Pixelblaze.getPreviewImage">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Gets the preview image (a JPEG with 150 iterations of the pattern) saved within a pattern.</span>

<span class="sd">        Args:</span>
<span class="sd">            patternId (str): The patternId of the desired pattern.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bytes: A JPEG image in which each column represents a particular LED and each row represents an iteration of the pattern.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;getPreviewImg&quot;</span><span class="p">:</span> <span class="n">patternId</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">messageTypes</span><span class="o">.</span><span class="n">previewImage</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getActiveVariables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getActiveVariables"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getActiveVariables" href="../../pixelblaze/#pixelblaze.Pixelblaze.getActiveVariables">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Gets the names and values of all variables exported by the current pattern.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary containing all the variables exported by the active pattern, with variableName as the key and variableValue as the value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;getVars&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="s2">&quot;vars&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">setActiveVariables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dictVariables</span><span class="p">:</span><span class="nb">dict</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setActiveVariables"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setActiveVariables" href="../../pixelblaze/#pixelblaze.Pixelblaze.setActiveVariables">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Sets the values of one or more variables exported by the current pattern.</span>

<span class="sd">        Variables not present in the current pattern are ignored.</span>

<span class="sd">        Args:</span>
<span class="sd">            dict: A dictionary containing the variables to be set, with variableName as the key and variableValue as the value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;setVars&quot;</span><span class="p">:</span> <span class="n">dictVariables</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setActiveControls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dictControls</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">saveToFlash</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setActiveControls"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setActiveControls" href="../../pixelblaze/#pixelblaze.Pixelblaze.setActiveControls">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Sets the value of one or more UI controls exported from the active pattern.</span>

<span class="sd">        Args:</span>
<span class="sd">            dictControls (dict): A dictionary containing the values to be set, with controlName as the key and controlValue as the value.</span>
<span class="sd">            saveToFlash (bool, optional): If True, the setting is stored in Flash memory; otherwise the value reverts on a reboot. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;setControls&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">dictControls</span><span class="p">),</span> <span class="s2">&quot;save&quot;</span><span class="p">:</span> <span class="n">saveToFlash</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="s2">&quot;ack&quot;</span><span class="p">)</span>

    <span class="c1"># --- PATTERNS tab: SAVED PATTERNS section: convenience functions</span>
    <span class="sd">&quot;&quot;&quot;The Pixelblaze API has functions to &#39;set&#39; individual property values, </span>
<span class="sd">    but can only &#39;get&#39; property values as part of a JSON dictionary containing all the settings</span>
<span class="sd">    on a particular UI page. These functions will extract the property value from a </span>
<span class="sd">    previously-fetched dictionary, if provided; otherwise they will fetch the settings anew.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">getActivePattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configSequencer</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getActivePattern"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getActivePattern" href="../../pixelblaze/#pixelblaze.Pixelblaze.getActivePattern">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns the ID of the pattern currently running on the Pixelblaze.</span>

<span class="sd">        Args:</span>
<span class="sd">            configSequencer (dict, optional): If provided, extracts the value from the results of a previous call to `getConfigSequencer`; otherwise, fetches the configSequencer from the Pixelblaze anew. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The patternId of the current pattern, if any; otherwise an empty string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configSequencer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">configSequencer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfigSequencer</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">configSequencer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;activeProgram&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;activeProgramId&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getActiveControls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configSequencer</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getActiveControls"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getActiveControls" href="../../pixelblaze/#pixelblaze.Pixelblaze.getActiveControls">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns the collection of controls for the pattern currently running on the Pixelblaze.</span>

<span class="sd">        If there are no controls or no pattern has been set, returns an empty dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            configSequencer (dict, optional): If provided, extracts the value from the results of a previous call to `getConfigSequencer`; otherwise, fetches the configSequencer from the Pixelblaze anew. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary containing the control names and values, with controlName as the key and controlValue as the value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configSequencer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">configSequencer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfigSequencer</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">configSequencer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;activeProgram&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;controls&#39;</span><span class="p">,</span> <span class="p">{})</span>

    <span class="c1"># --- EDIT tab:</span>

    <span class="k">def</span> <span class="nf">getPatternControls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patternId</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getPatternControls"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getPatternControls" href="../../pixelblaze/#pixelblaze.Pixelblaze.getPatternControls">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns the name and value of any UI controls exported by the specified pattern.</span>

<span class="sd">        Args:</span>
<span class="sd">            patternId (str): The patternId of the pattern.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary containing the control names and values, with controlName as the key and controlValue as the value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;getControls&quot;</span><span class="p">:</span> <span class="n">patternId</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="s2">&quot;controls&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">getPatternSourceCode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patternId</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getPatternSourceCode"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getPatternSourceCode" href="../../pixelblaze/#pixelblaze.Pixelblaze.getPatternSourceCode">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Gets the sourceCode of a saved pattern from the Pixelblaze.</span>

<span class="sd">        Args:</span>
<span class="sd">            patternId (str): The patternId of the desired pattern.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: A string representation of a JSON dictionary containing the pattern source code.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;getSources&quot;</span><span class="p">:</span><span class="n">patternId</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">messageTypes</span><span class="o">.</span><span class="n">getSourceCode</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sources</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="n">_LZstring</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">sources</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">sendPatternToRenderer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bytecode</span><span class="p">:</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">controls</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="p">{}):</span><span id="pixelblaze.Pixelblaze.sendPatternToRenderer"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.sendPatternToRenderer" href="../../pixelblaze/#pixelblaze.Pixelblaze.sendPatternToRenderer">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Sends a blob of bytecode and a JSON dictionary of UI controls to the Renderer. Mimics the actions of the webUI code editor.</span>

<span class="sd">        Args:</span>
<span class="sd">            bytecode (bytes): A valid blob of bytecode as generated by the Editor tab in the Pixelblaze webUI.</span>
<span class="sd">            controls (dict, optional): a dictionary of UI controls exported by the pattern, with controlName as the key and controlValue as the value. Defaults to {}.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;pause&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;setCode&quot;</span><span class="p">:{</span> <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">bytecode</span><span class="p">)}},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="s2">&quot;ack&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendBinary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">messageTypes</span><span class="o">.</span><span class="n">putByteCode</span><span class="p">,</span> <span class="n">bytecode</span><span class="p">,</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="s2">&quot;ack&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;setControls&quot;</span><span class="p">:</span> <span class="n">controls</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="s2">&quot;ack&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;pause&quot;</span><span class="p">:</span><span class="kc">False</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="s2">&quot;ack&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">savePattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">previewImage</span><span class="p">:</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">sourceCode</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">byteCode</span><span class="p">:</span><span class="nb">bytes</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.savePattern"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.savePattern" href="../../pixelblaze/#pixelblaze.Pixelblaze.savePattern">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Saves a new pattern to the Pixelblaze filesystem.  Mimics the effects of the &#39;Save&#39; button.</span>

<span class="sd">        If you don&#39;t know how to generate the previewImage and byteCode components, you don&#39;t want to do this.</span>

<span class="sd">        Args:</span>
<span class="sd">            previewImage (bytes): A JPEG image in which each column represents a particular LED and each row represents an iteration of the pattern.</span>
<span class="sd">            sourceCode (str): A string representation of a JSON dictionary containing the pattern source code.</span>
<span class="sd">            byteCode (bytes): A valid blob of bytecode as generated by the Editor tab in the Pixelblaze webUI.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendBinary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">messageTypes</span><span class="o">.</span><span class="n">previewImage</span><span class="p">,</span> <span class="n">previewImage</span><span class="p">,</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="s2">&quot;ack&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendBinary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">messageTypes</span><span class="o">.</span><span class="n">putSourceCode</span><span class="p">,</span> <span class="n">_LZstring</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">sourceCode</span><span class="p">),</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="s2">&quot;ack&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendBinary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">messageTypes</span><span class="o">.</span><span class="n">putByteCode</span><span class="p">,</span> <span class="n">byteCode</span><span class="p">,</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="s2">&quot;ack&quot;</span><span class="p">)</span>

    <span class="c1"># --- MAPPER tab: Pixelmap settings</span>

    <span class="k">def</span> <span class="nf">getMapFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getMapFunction"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getMapFunction" href="../../pixelblaze/#pixelblaze.Pixelblaze.getMapFunction">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns the mapFunction text used to populate the Mapper tab in the Pixelblaze UI.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The text of the mapFunction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFile</span><span class="p">(</span><span class="s2">&quot;/pixelmap.txt&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setMapFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapFunction</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.setMapFunction"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setMapFunction" href="../../pixelblaze/#pixelblaze.Pixelblaze.setMapFunction">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Sets the mapFunction text used to populate the Mapper tab in the Pixelblaze UI.</span>

<span class="sd">        Note that this is does not change the mapData used by the Pixelblaze; the Mapper tab in the Pixelblaze UI compiles this text to produce binary mapData which is saved separately (see the `setMapData` function).</span>

<span class="sd">        Args:</span>
<span class="sd">            mapFunction (str): The text of the mapFunction.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the function text was successfully saved; otherwise False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TBD:  Using an embeddable Javscript intepreter like dukpy (https://github.com/amol-/dukpy) it would </span>
        <span class="c1"># be possible to execute the mapFunction text and generate the binary mapData, which is what the Pixelblaze </span>
        <span class="c1"># map editor does whenever the map function is changed.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">putFile</span><span class="p">(</span><span class="s1">&#39;/pixelmap.txt&#39;</span><span class="p">,</span> <span class="n">mapFunction</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getMapData</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getMapData"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getMapData" href="../../pixelblaze/#pixelblaze.Pixelblaze.getMapData">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Gets the binary representation of the pixelMap entered on the &#39;Mapper&#39; tab.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bytes: The binary mapData as generated by the Mapper tab of the Pixelblaze webUI.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFile</span><span class="p">(</span><span class="s1">&#39;/pixelmap.dat&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setMapData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapData</span><span class="p">:</span><span class="nb">bytes</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">saveToFlash</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setMapData"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setMapData" href="../../pixelblaze/#pixelblaze.Pixelblaze.setMapData">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Sets the binary mapData used by the Pixelblaze.</span>

<span class="sd">        Args:</span>
<span class="sd">            mapData (bytes): a blob of binary mapData as generated by the Mapper tab of the Pixelblaze webUI.</span>
<span class="sd">            saveToFlash (bool, optional): A boolean indicating whether the mapData should be saved to Flash. Defaults to True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Send the mapData...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendBinary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">messageTypes</span><span class="o">.</span><span class="n">putPixelMap</span><span class="p">,</span> <span class="n">mapData</span><span class="p">,</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="s2">&quot;ack&quot;</span><span class="p">)</span>
        <span class="c1"># ...and make it permanent (same as pressing &quot;Save&quot; in the map editor).</span>
        <span class="k">if</span> <span class="n">saveToFlash</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;savePixelMap&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># --- SETTINGS menu</span>

    <span class="k">def</span> <span class="nf">getConfigSettings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getConfigSettings"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getConfigSettings" href="../../pixelblaze/#pixelblaze.Pixelblaze.getConfigSettings">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns the configuration as defined on the Settings tab of the Pixelblaze.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary containing the configuration settings, with settingName as the key and settingValue as the value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># In response to this command, the Pixelblaze actually returns three separate messages representing the </span>
        <span class="c1"># configuration of the Settings page, the configuration of the Sequencer and and the configuration of the outputExpander (if it exists).</span>
        <span class="c1"># The Settings configuration is a JSON message and always comes first; the Sequencer configuration (a JSON message)</span>
        <span class="c1"># and the OutputExpander configuration (a binary message) can come in either order so we have to be flexible in what we accept.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">latestSequencer</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># clear cache to force refresh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">latestExpander</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># clear cache to force refresh</span>

        <span class="c1"># First the config packet.</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;getConfig&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsReceive</span><span class="p">(</span><span class="n">binaryMessageType</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">settings</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
                <span class="k">break</span>

        <span class="c1"># Now the others, in any order.</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latestSequencer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latestExpander</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">ignored</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsReceive</span><span class="p">(</span><span class="n">binaryMessageType</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">break</span>

        <span class="c1"># Now that we&#39;ve got them all, return the settings.</span>
        <span class="k">return</span> <span class="n">settings</span>

    <span class="k">def</span> <span class="nf">getConfigSequencer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getConfigSequencer"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getConfigSequencer" href="../../pixelblaze/#pixelblaze.Pixelblaze.getConfigSequencer">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Retrieves the Sequencer state.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: The sequencer configuration as a dictionary, with settingName as the key and settingValue as the value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">latestSequencer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">latestSequencer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">ignored</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfigSettings</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latestSequencer</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">getConfigExpander</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getConfigExpander"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getConfigExpander" href="../../pixelblaze/#pixelblaze.Pixelblaze.getConfigExpander">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Retrieves the OutputExpander configuration.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: The OutputExpander configuration as a dictionary, with settingName as the key and settingValue as the value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">latestExpander</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">latestExpander</span>
            <span class="n">ignored</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfigSettings</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__decodeExpanderData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span><span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;An internal function to convert the OutputExpander from its native binary format into a human-readable JSON representation.</span>

<span class="sd">        Args:</span>
<span class="sd">            data (bytes): The binary OutputExpander blob received from the Pixelblaze.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A human-readable dictionary of the configuration items.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check that we support the version number.</span>
        <span class="n">versionNumber</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">versionNumber</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;expanders&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;expander data has incorrect magic number (expected 5, received </span><span class="si">{</span><span class="n">versionNumber</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">}</span>

        <span class="c1"># Parse the rest of the data.</span>
        <span class="n">binaryData</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">binarySize</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">binaryData</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">binarySize</span> <span class="o">%</span> <span class="mi">96</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;expanders&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;expander data has incorrect length (must be a multiple of 96, received </span><span class="si">{</span><span class="n">versionNumber</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">}</span>

        <span class="c1"># Convert the file to a human-readable equivalent.</span>
        <span class="n">rowSize</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="n">boards</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;expanders&#39;</span><span class="p">:</span> <span class="p">[</span> <span class="p">]</span> <span class="p">}</span>
        <span class="c1">#ledTypes = [ &#39;notUsed&#39;, &#39;WS2812B&#39;, &#39;drawAll&#39;, &#39;APA102 Data&#39;, &#39;APA102 Clock&#39; ]</span>
        <span class="n">colorOrders</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x24</span><span class="p">:</span> <span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">:</span> <span class="s1">&#39;RBG&#39;</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">:</span> <span class="s1">&#39;BRG&#39;</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">:</span> <span class="s1">&#39;BGR&#39;</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">:</span> <span class="s1">&#39;GRB&#39;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">:</span> <span class="s1">&#39;GBR&#39;</span><span class="p">,</span> <span class="mh">0xE4</span><span class="p">:</span> <span class="s1">&#39;RGBW&#39;</span><span class="p">,</span> <span class="mh">0xE1</span><span class="p">:</span> <span class="s1">&#39;GRBW&#39;</span> <span class="p">}</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">binarySize</span> <span class="o">//</span> <span class="n">rowSize</span><span class="p">):</span>
            <span class="n">offsets</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&lt;4B2H4x&#39;</span><span class="p">,</span> <span class="n">binaryData</span><span class="p">[(</span><span class="n">row</span> <span class="o">*</span> <span class="n">rowSize</span><span class="p">):(</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">rowSize</span><span class="p">])</span>
            <span class="n">boardAddress</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="mi">8</span>
            <span class="n">ledType</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">numElements</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">colorOrder</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">pixelCount</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">startIndex</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">dataSpeed</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>

            <span class="c1">#   boardAddress</span>
            <span class="c1">#       channel | type | startIndex | pixelCount | colorOrder | dataSpeed</span>
            <span class="n">board</span> <span class="o">=</span> <span class="n">row</span> <span class="o">//</span> <span class="mi">8</span>
            <span class="n">rowNumber</span> <span class="o">=</span> <span class="n">row</span> <span class="o">%</span> <span class="mi">8</span>
            <span class="k">if</span> <span class="n">rowNumber</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># start a new board</span>
                <span class="n">boards</span><span class="p">[</span><span class="s1">&#39;expanders&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span> <span class="s1">&#39;address&#39;</span><span class="p">:</span> <span class="n">boardAddress</span><span class="p">,</span> <span class="s1">&#39;rows&#39;</span><span class="p">:</span> <span class="p">{</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
            <span class="n">boards</span><span class="p">[</span><span class="s1">&#39;expanders&#39;</span><span class="p">][</span><span class="n">board</span><span class="p">][</span><span class="s1">&#39;rows&#39;</span><span class="p">][</span><span class="n">rowNumber</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>
            <span class="k">if</span> <span class="n">ledType</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">ledType</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">boards</span><span class="p">[</span><span class="s1">&#39;expanders&#39;</span><span class="p">][</span><span class="n">board</span><span class="p">][</span><span class="s1">&#39;rows&#39;</span><span class="p">][</span><span class="n">rowNumber</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span> <span class="s1">&#39;channel&#39;</span><span class="p">:</span> <span class="n">channel</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">ledType</span><span class="p">,</span> <span class="s1">&#39;startIndex&#39;</span><span class="p">:</span> <span class="n">startIndex</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">pixelCount</span><span class="p">,</span> <span class="s1">&#39;options&#39;</span><span class="p">:</span> <span class="n">colorOrders</span><span class="p">[</span><span class="n">colorOrder</span><span class="p">],</span> <span class="s1">&#39;dataSpeed&#39;</span><span class="p">:</span> <span class="n">dataSpeed</span> <span class="p">}</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">boards</span><span class="p">[</span><span class="s1">&#39;expanders&#39;</span><span class="p">][</span><span class="n">board</span><span class="p">][</span><span class="s1">&#39;rows&#39;</span><span class="p">][</span><span class="n">rowNumber</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span> <span class="s1">&#39;channel&#39;</span><span class="p">:</span> <span class="n">channel</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">ledType</span> <span class="p">}</span> <span class="p">)</span>

        <span class="c1"># Return the finished configuration.</span>
        <span class="k">return</span> <span class="n">boards</span>

    <span class="c1"># --- SETTINGS menu: CONTROLLER section: NAME settings</span>

    <span class="k">def</span> <span class="nf">setDeviceName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setDeviceName"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setDeviceName" href="../../pixelblaze/#pixelblaze.Pixelblaze.setDeviceName">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Sets the device name of the Pixelblaze.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): The human-readable name of the Pixelblaze.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="n">name</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setDiscovery</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enableDiscovery</span><span class="p">:</span><span class="nb">bool</span><span class="p">,</span> <span class="n">timezoneName</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setDiscovery"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setDiscovery" href="../../pixelblaze/#pixelblaze.Pixelblaze.setDiscovery">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Sets whether this Pixelblaze announces its presence to (and gets a clocktime reference from) the Electromage Discovery Service.</span>

<span class="sd">        Args:</span>
<span class="sd">            enableDiscovery (bool): A boolean controlling whether or not this Pixelblaze announces itself to the Electromage Discovery Service.</span>
<span class="sd">            timezoneName (str, optional): If present, a Unix tzstring specifying how to adjust the clocktime reference received from the Electromage Discovery Service. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">timezoneName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="c1"># Validate the timezone name.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">timezoneName</span> <span class="ow">in</span> <span class="n">pytz</span><span class="o">.</span><span class="n">all_timezones</span><span class="p">:</span> 
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;setDiscovery: unrecognized timezone </span><span class="si">{</span><span class="n">timezoneName</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;discoveryEnable&quot;</span><span class="p">:</span> <span class="n">enableDiscovery</span><span class="p">,</span> <span class="s2">&quot;timezone&quot;</span><span class="p">:</span> <span class="n">timezoneName</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setTimezone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timezoneName</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setTimezone"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setTimezone" href="../../pixelblaze/#pixelblaze.Pixelblaze.setTimezone">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Sets the Pixelblaze&#39;s timezone, which specifies how to adjust the clocktime reference provided by the Electromage Discovery Service.</span>

<span class="sd">        To clear the timezone, pass an empty string.</span>

<span class="sd">        Args:</span>
<span class="sd">            timezoneName (str): A Unix tzstring specifying how to adjust the clocktime reference provided by the Electromage Discovery Service.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">timezoneName</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Validate the timezone name.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">timezoneName</span> <span class="ow">in</span> <span class="n">pytz</span><span class="o">.</span><span class="n">all_timezones</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;setDiscovery: unrecognized timezone </span><span class="si">{</span><span class="n">timezoneName</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;timezone&quot;</span><span class="p">:</span> <span class="n">timezoneName</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setAutoOffEnable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boolValue</span><span class="p">:</span><span class="nb">bool</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">saveToFlash</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setAutoOffEnable"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setAutoOffEnable" href="../../pixelblaze/#pixelblaze.Pixelblaze.setAutoOffEnable">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Enables or disables the Pixelblaze&#39;s auto-Off scheduler.</span>

<span class="sd">        Args:</span>
<span class="sd">            boolValue (bool): A boolean indicating whether the auto-Off scheduler should be used.</span>
<span class="sd">            saveToFlash (bool, optional): If True, the setting is stored in Flash memory; otherwise the value reverts on a reboot. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;autoOffEnable&quot;</span><span class="p">:</span> <span class="n">boolValue</span><span class="p">,</span> <span class="s2">&quot;save&quot;</span><span class="p">:</span> <span class="n">saveToFlash</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setAutoOffStart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeValue</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">saveToFlash</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setAutoOffStart"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setAutoOffStart" href="../../pixelblaze/#pixelblaze.Pixelblaze.setAutoOffStart">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Sets the time at which the Pixelblaze will turn off the pattern.</span>

<span class="sd">        Args:</span>
<span class="sd">            timeValue (str): A Unix time string in &quot;HH:MM&quot; format.</span>
<span class="sd">            saveToFlash (bool, optional): If True, the setting is stored in Flash memory; otherwise the value reverts on a reboot. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#if type(timeValue) is time: timeValue = timeValue.strftime(&#39;%H:%M&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;autoOffStart&quot;</span><span class="p">:</span> <span class="n">timeValue</span><span class="p">,</span> <span class="s2">&quot;save&quot;</span><span class="p">:</span> <span class="n">saveToFlash</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setAutoOffEnd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeValue</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">saveToFlash</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setAutoOffEnd"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setAutoOffEnd" href="../../pixelblaze/#pixelblaze.Pixelblaze.setAutoOffEnd">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Sets the time at which the Pixelblaze will turn on the pattern.</span>

<span class="sd">        Args:</span>
<span class="sd">            timeValue (str): A Unix time string in &quot;HH:MM&quot; format.</span>
<span class="sd">            saveToFlash (bool, optional): If True, the setting is stored in Flash memory; otherwise the value reverts on a reboot. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#if type(timeValue) is time: timeValue = timeValue.strftime(&#39;%H:%M&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;autoOffEnd&quot;</span><span class="p">:</span> <span class="n">timeValue</span><span class="p">,</span> <span class="s2">&quot;save&quot;</span><span class="p">:</span> <span class="n">saveToFlash</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># --- SETTINGS menu: CONTROLLER section: NAME settings: helper functions:</span>
    <span class="sd">&quot;&quot;&quot;The Pixelblaze API has functions to &#39;set&#39; individual property values, </span>
<span class="sd">    but can only &#39;get&#39; property values as part of a JSON dictionary containing all the settings</span>
<span class="sd">    on a particular UI page. These functions will extract the property value from a </span>
<span class="sd">    previously-fetched dictionary, if provided; otherwise they will fetch the settings anew.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">getDeviceName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configSettings</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getDeviceName"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getDeviceName" href="../../pixelblaze/#pixelblaze.Pixelblaze.getDeviceName">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns the user-friendly name of the Pixelblaze.</span>

<span class="sd">        Args:</span>
<span class="sd">            configSettings (dict, optional): If provided, extracts the value from the results of a previous call to `getConfigSettings`; otherwise, fetches the configSettings from the Pixelblaze anew. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The user-friendly name of the Pixelblaze.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configSettings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">configSettings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfigSettings</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">configSettings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getDiscovery</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configSettings</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getDiscovery"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getDiscovery" href="../../pixelblaze/#pixelblaze.Pixelblaze.getDiscovery">DOCS</a>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a boolean signifying whether the Pixelblaze announces itself to the Electromage Discovery Service.</span>

<span class="sd">        Args:</span>
<span class="sd">            configSettings (dict, optional): If provided, extracts the value from the results of a previous call to `getConfigSettings`; otherwise, fetches the configSettings from the Pixelblaze anew. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: A boolean signifying whether the Pixelblaze announces itself to the Electromage Discovery Service.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configSettings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">configSettings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfigSettings</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">configSettings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;discoveryEnable&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getTimezone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configSettings</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getTimezone"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getTimezone" href="../../pixelblaze/#pixelblaze.Pixelblaze.getTimezone">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns the timezone, if any, for the Pixelblaze.</span>

<span class="sd">        Args:</span>
<span class="sd">            configSettings (dict, optional): If provided, extracts the value from the results of a previous call to `getConfigSettings`; otherwise, fetches the configSettings from the Pixelblaze anew. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: A standard Unix tzstring.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configSettings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">configSettings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfigSettings</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">configSettings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;timezone&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getAutoOffEnable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configSettings</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getAutoOffEnable"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getAutoOffEnable" href="../../pixelblaze/#pixelblaze.Pixelblaze.getAutoOffEnable">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns whether the auto-Off timer is enabled.</span>

<span class="sd">        Args:</span>
<span class="sd">            configSettings (dict, optional): If provided, extracts the value from the results of a previous call to `getConfigSettings`; otherwise, fetches the configSettings from the Pixelblaze anew. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: A boolean indicating whether the auto-Off timer is enabled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configSettings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">configSettings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfigSettings</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">configSettings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;autoOffEnable&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getAutoOffStart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configSettings</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getAutoOffStart"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getAutoOffStart" href="../../pixelblaze/#pixelblaze.Pixelblaze.getAutoOffStart">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns the time, if any, at which the Pixelblaze will turn off the pattern when the auto-Off timer is enabled.</span>

<span class="sd">        Args:</span>
<span class="sd">            configSettings (dict, optional): If provided, extracts the value from the results of a previous call to `getConfigSettings`; otherwise, fetches the configSettings from the Pixelblaze anew. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: A Unix time string in &quot;HH:MM&quot; format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configSettings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">configSettings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfigSettings</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">configSettings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;autoOffStart&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getAutoOffEnd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configSettings</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getAutoOffEnd"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getAutoOffEnd" href="../../pixelblaze/#pixelblaze.Pixelblaze.getAutoOffEnd">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns the time, if any, at which the Pixelblaze will turn on the pattern when the auto-Off timer is enabled.</span>

<span class="sd">        Args:</span>
<span class="sd">            configSettings (dict, optional): If provided, extracts the value from the results of a previous call to `getConfigSettings`; otherwise, fetches the configSettings from the Pixelblaze anew. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: A Unix time string in &quot;HH:MM&quot; format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configSettings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">configSettings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfigSettings</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">configSettings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;autoOffEnd&#39;</span><span class="p">)</span>

    <span class="c1"># --- SETTINGS menu: CONTROLLER section: LED settings</span>

    <span class="k">def</span> <span class="nf">setBrightnessLimit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxBrightness</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">saveToFlash</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setBrightnessLimit"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setBrightnessLimit" href="../../pixelblaze/#pixelblaze.Pixelblaze.setBrightnessLimit">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Sets the Pixelblaze&#39;s global brightness limit.</span>

<span class="sd">        Args:</span>
<span class="sd">            maxBrightness (int): The maximum brightness, expressed as a percent value between 0 and 100 (yes, it&#39;s inconsistent with the &#39;brightness&#39; settings).</span>
<span class="sd">            saveToFlash (bool, optional): If True, the setting is stored in Flash memory; otherwise the value reverts on a reboot. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;maxBrightness&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clamp</span><span class="p">(</span><span class="n">maxBrightness</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="s2">&quot;save&quot;</span><span class="p">:</span> <span class="n">saveToFlash</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">ledTypes</span><span class="p">(</span><span class="n">IntEnum</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.ledTypes"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.ledTypes" href="../../pixelblaze/#pixelblaze.Pixelblaze.ledTypes">DOCS</a>
        <span class="n">noLeds</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">APA102</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">SK9822</span> <span class="o">=</span> <span class="mi">1</span>                  <span class="c1">#synonym for APA102</span>
        <span class="n">DotStar</span> <span class="o">=</span> <span class="mi">1</span>                 <span class="c1">#synonym for APA102</span>
        <span class="n">unbufferedWS2812</span> <span class="o">=</span> <span class="mi">2</span>        <span class="c1">#v2 type</span>
        <span class="n">unbufferedSK6822</span> <span class="o">=</span> <span class="mi">2</span>        <span class="c1">#v2 synonym for unbufferedWS2812</span>
        <span class="n">unbufferedNeoPixel</span> <span class="o">=</span> <span class="mi">2</span>      <span class="c1">#v2 synonym for unbufferedWS2812</span>
        <span class="n">WS2812</span> <span class="o">=</span> <span class="mi">2</span>                  <span class="c1">#v3 type</span>
        <span class="n">SK6822</span> <span class="o">=</span> <span class="mi">2</span>                  <span class="c1">#v3 synonym for WS2812</span>
        <span class="n">NeoPixel</span> <span class="o">=</span> <span class="mi">2</span>                <span class="c1">#v3 synonym for WS2812</span>
        <span class="n">WS2801</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">bufferedWS2812</span> <span class="o">=</span> <span class="mi">4</span>          <span class="c1">#v2 only</span>
        <span class="n">bufferedSK6822</span> <span class="o">=</span> <span class="mi">4</span>          <span class="c1">#v2 synonym for bufferedWS2812</span>
        <span class="n">bufferedNeoPixel</span> <span class="o">=</span> <span class="mi">4</span>        <span class="c1">#v2 synonym for bufferedWS2812</span>
        <span class="n">OutputExpander</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="k">def</span> <span class="nf">setLedType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ledType</span><span class="p">:</span><span class="n">ledTypes</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">dataSpeed</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">saveToFlash</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setLedType"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setLedType" href="../../pixelblaze/#pixelblaze.Pixelblaze.setLedType">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Defines the type of LEDs connected to the Pixelblaze.</span>

<span class="sd">        Args:</span>
<span class="sd">            ledType (ledTypes): The type of LEDs connected to the Pixelblaze.</span>
<span class="sd">            dataSpeed (int, optional): If provided, sets a custom data speed for communication with the LEDs; otherwise the defaults from the webUI are used. Defaults to None.</span>
<span class="sd">            saveToFlash (bool, optional): If True, the setting is stored in Flash memory; otherwise the value reverts on a reboot. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">ledType</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">ledTypes</span>
        <span class="c1"># If no dataSpeed was specified, default to what the v3 UI sends.</span>
        <span class="k">if</span> <span class="n">dataSpeed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ledType</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ledTypes</span><span class="o">.</span><span class="n">noLeds</span><span class="p">:</span> <span class="n">dataSpeed</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">ledType</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ledTypes</span><span class="o">.</span><span class="n">APA102</span><span class="p">:</span> <span class="n">dataSpeed</span> <span class="o">=</span> <span class="mi">2000000</span>
            <span class="k">if</span> <span class="n">ledType</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ledTypes</span><span class="o">.</span><span class="n">WS2812</span><span class="p">:</span> <span class="n">dataSpeed</span> <span class="o">=</span> <span class="mi">2250000</span> <span class="c1">#3500000 for v2</span>
            <span class="k">if</span> <span class="n">ledType</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ledTypes</span><span class="o">.</span><span class="n">WS2801</span><span class="p">:</span> <span class="n">dataSpeed</span> <span class="o">=</span> <span class="mi">2000000</span>
            <span class="k">if</span> <span class="n">ledType</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ledTypes</span><span class="o">.</span><span class="n">bufferedWS2812</span><span class="p">:</span> <span class="n">dataSpeed</span> <span class="o">=</span> <span class="mi">3500000</span>
            <span class="k">if</span> <span class="n">ledType</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ledTypes</span><span class="o">.</span><span class="n">OutputExpander</span><span class="p">:</span> <span class="n">dataSpeed</span> <span class="o">=</span> <span class="mi">2000000</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;ledType&quot;</span><span class="p">:</span> <span class="n">ledType</span><span class="p">,</span> <span class="s2">&quot;dataSpeed&quot;</span><span class="p">:</span> <span class="n">dataSpeed</span><span class="p">,</span> <span class="s2">&quot;save&quot;</span><span class="p">:</span> <span class="n">saveToFlash</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setPixelCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nPixels</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">saveToFlash</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setPixelCount"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setPixelCount" href="../../pixelblaze/#pixelblaze.Pixelblaze.setPixelCount">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Sets the number of LEDs attached to the Pixelblaze.</span>

<span class="sd">        Note that changing the number of pixels does not recalculate the pixelMap.</span>

<span class="sd">        Args:</span>
<span class="sd">            nPixels (int): The number of pixels.</span>
<span class="sd">            saveToFlash (bool, optional): If True, the setting is stored in Flash memory; otherwise the value reverts on a reboot. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TBD: The Pixelblaze UI also re-evaluates the map function and resends the map data...Should we do the same?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;pixelCount&quot;</span><span class="p">:</span> <span class="n">nPixels</span><span class="p">,</span> <span class="s2">&quot;save&quot;</span><span class="p">:</span> <span class="n">saveToFlash</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setDataSpeed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">saveToFlash</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setDataSpeed"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setDataSpeed" href="../../pixelblaze/#pixelblaze.Pixelblaze.setDataSpeed">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Sets custom data rate for communicating with the LEDs.</span>

<span class="sd">        CAUTION: For advanced users only.  If you don&#39;t know exactly why you want to do this, DON&#39;T DO IT.</span>
<span class="sd">        See discussion in this thread on the Pixelblaze forum: https://forum.electromage.com/t/timing-of-a-cheap-strand/739</span>

<span class="sd">        Args:</span>
<span class="sd">            speed (int): The data rate for communicating with the LEDs.</span>
<span class="sd">            saveToFlash (bool, optional): If True, the setting is stored in Flash memory; otherwise the value reverts on a reboot. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;dataSpeed&quot;</span><span class="p">:</span> <span class="n">speed</span><span class="p">,</span> <span class="s2">&quot;save&quot;</span><span class="p">:</span> <span class="n">saveToFlash</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">colorOrders</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.colorOrders"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.colorOrders" href="../../pixelblaze/#pixelblaze.Pixelblaze.colorOrders">DOCS</a>
        <span class="n">RGB</span> <span class="o">=</span> <span class="s1">&#39;RGB&#39;</span>
        <span class="n">RBG</span> <span class="o">=</span> <span class="s1">&#39;RBG&#39;</span>
        <span class="n">BRG</span> <span class="o">=</span> <span class="s1">&#39;BRG&#39;</span>
        <span class="n">BGR</span> <span class="o">=</span> <span class="s1">&#39;BGR&#39;</span>
        <span class="n">GRB</span> <span class="o">=</span> <span class="s1">&#39;GRB&#39;</span>
        <span class="n">GBR</span> <span class="o">=</span> <span class="s1">&#39;GBR&#39;</span>
        <span class="n">RGBW</span> <span class="o">=</span> <span class="s1">&#39;RGBW&#39;</span>
        <span class="n">GRBW</span> <span class="o">=</span> <span class="s1">&#39;GRBW&#39;</span>
        <span class="n">RGB_W</span> <span class="o">=</span> <span class="s1">&#39;RGB-W&#39;</span>
        <span class="n">GRB_W</span> <span class="o">=</span> <span class="s1">&#39;GRB-W&#39;</span>

    <span class="k">def</span> <span class="nf">setColorOrder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colorOrder</span><span class="p">:</span><span class="n">colorOrders</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">saveToFlash</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setColorOrder"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setColorOrder" href="../../pixelblaze/#pixelblaze.Pixelblaze.setColorOrder">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Sets the color order for the LEDs connected to the Pixelblaze.</span>

<span class="sd">        Args:</span>
<span class="sd">            colorOrder (colorOrders): The ordering for the color data sent to the LEDs.</span>
<span class="sd">            saveToFlash (bool, optional): If True, the setting is stored in Flash memory; otherwise the value reverts on a reboot. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">colorOrder</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorOrders</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;colorOrder&quot;</span><span class="p">:</span> <span class="n">colorOrder</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;save&quot;</span><span class="p">:</span> <span class="n">saveToFlash</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># --- SETTINGS menu: CONTROLLER section: LED settings: helper functions:</span>
    <span class="sd">&quot;&quot;&quot;The Pixelblaze API has functions to &#39;set&#39; individual property values, </span>
<span class="sd">    but can only &#39;get&#39; property values as part of a JSON dictionary containing all the settings</span>
<span class="sd">    on a particular UI page. These functions will extract the property value from a </span>
<span class="sd">    previously-fetched dictionary, if provided; otherwise they will fetch the settings anew.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">getBrightnessLimit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configSettings</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getBrightnessLimit"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getBrightnessLimit" href="../../pixelblaze/#pixelblaze.Pixelblaze.getBrightnessLimit">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns the maximum brightness for the Pixelblaze.</span>

<span class="sd">        Args:</span>
<span class="sd">            configSettings (dict, optional): If provided, extracts the value from the results of a previous call to `getConfigSettings`; otherwise, fetches the configSettings from the Pixelblaze anew. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: The maximum brightness, expressed as a percent value between 0 and 100 (yes, it&#39;s inconsistent with the &#39;brightness&#39; settings).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configSettings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">configSettings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfigSettings</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">configSettings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;maxBrightness&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getLedType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configSettings</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ledTypes</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getLedType"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getLedType" href="../../pixelblaze/#pixelblaze.Pixelblaze.getLedType">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns the type of LEDs connected to the Pixelblaze.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configSettings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">configSettings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfigSettings</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ledTypes</span><span class="p">(</span><span class="n">configSettings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ledType&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">getPixelCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configSettings</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getPixelCount"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getPixelCount" href="../../pixelblaze/#pixelblaze.Pixelblaze.getPixelCount">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns the number of LEDs connected to the Pixelblaze.</span>

<span class="sd">        Args:</span>
<span class="sd">            configSettings (dict, optional): If provided, extracts the value from the results of a previous call to `getConfigSettings`; otherwise, fetches the configSettings from the Pixelblaze anew. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: The number of LEDs connected to the Pixelblaze.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configSettings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">configSettings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfigSettings</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">configSettings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pixelCount&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getDataSpeed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configSettings</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getDataSpeed"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getDataSpeed" href="../../pixelblaze/#pixelblaze.Pixelblaze.getDataSpeed">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns the data speed of the LEDs connected to the Pixelblaze.</span>

<span class="sd">        Args:</span>
<span class="sd">            configSettings (dict, optional): If provided, extracts the value from the results of a previous call to `getConfigSettings`; otherwise, fetches the configSettings from the Pixelblaze anew. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: The data speed for communicating with the LEDs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configSettings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">configSettings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfigSettings</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">configSettings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dataSpeed&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getColorOrder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configSettings</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">colorOrders</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getColorOrder"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getColorOrder" href="../../pixelblaze/#pixelblaze.Pixelblaze.getColorOrder">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns the color order of the LEDs connected to the Pixelblaze.</span>

<span class="sd">        Args:</span>
<span class="sd">            configSettings (dict, optional): If provided, extracts the value from the results of a previous call to `getConfigSettings`; otherwise, fetches the configSettings from the Pixelblaze anew. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            colorOrders: The ordering for the color data sent to the LEDs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configSettings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">configSettings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfigSettings</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">configSettings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;colorOrder&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># --- SETTINGS menu (v3 only): CONTROLLER section: POWER SAVING settings</span>

    <span class="k">class</span> <span class="nc">cpuSpeeds</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.cpuSpeeds"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.cpuSpeeds" href="../../pixelblaze/#pixelblaze.Pixelblaze.cpuSpeeds">DOCS</a>
        <span class="n">low</span> <span class="o">=</span> <span class="s2">&quot;80&quot;</span>
        <span class="n">medium</span> <span class="o">=</span> <span class="s2">&quot;160&quot;</span>
        <span class="n">high</span> <span class="o">=</span> <span class="s2">&quot;240&quot;</span>

    <span class="k">def</span> <span class="nf">setCpuSpeed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cpuSpeed</span><span class="p">:</span><span class="n">cpuSpeeds</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setCpuSpeed"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setCpuSpeed" href="../../pixelblaze/#pixelblaze.Pixelblaze.setCpuSpeed">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Sets the CPU speed of the Pixelblaze.</span>

<span class="sd">        Note that this setting will not take effect until the Pixelblaze is rebooted (which can be done with the `reboot` function).</span>

<span class="sd">        Args:</span>
<span class="sd">            cpuSpeed (cpuSpeeds): The desired CPU speed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">cpuSpeed</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpuSpeeds</span>
        <span class="c1"># The &quot;cpuSpeed&quot; setting doesn&#39;t exist on v2, so ignore it if not v3.</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getConfigSettings</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ver&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;3&#39;</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;cpuSpeed&quot;</span><span class="p">:</span> <span class="n">cpuSpeed</span><span class="o">.</span><span class="n">value</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setNetworkPowerSave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">disableWifi</span><span class="p">:</span><span class="nb">bool</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setNetworkPowerSave"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setNetworkPowerSave" href="../../pixelblaze/#pixelblaze.Pixelblaze.setNetworkPowerSave">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Enables or disables the WiFi connection on the Pixelblaze, which can significantly reduce power requirements for battery-powered installations.</span>

<span class="sd">        Note that this setting will not take effect until the Pixelblaze is rebooted (which can be done with the `reboot` function).</span>

<span class="sd">        Args:</span>
<span class="sd">            disableWifi (bool): A boolean indicating whether to disable Wifi.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;networkPowerSave&quot;</span><span class="p">:</span> <span class="n">disableWifi</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># --- GLOBAL functions: CONTROLS: helper functions:</span>
    <span class="sd">&quot;&quot;&quot;The Pixelblaze API has functions to &#39;set&#39; individual property values, </span>
<span class="sd">    but can only &#39;get&#39; property values as part of a JSON dictionary containing all the settings</span>
<span class="sd">    on a particular UI page. These functions will extract the property value from a </span>
<span class="sd">    previously-fetched dictionary, if provided; otherwise they will fetch the settings anew.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">getCpuSpeed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configSettings</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">cpuSpeeds</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getCpuSpeed"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getCpuSpeed" href="../../pixelblaze/#pixelblaze.Pixelblaze.getCpuSpeed">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns the CPU speed of the Pixelblaze.</span>

<span class="sd">        Args:</span>
<span class="sd">            configSettings (dict, optional): If provided, extracts the value from the results of a previous call to `getConfigSettings`; otherwise, fetches the configSettings from the Pixelblaze anew. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            cpuSpeeds: An enumeration representing the CPU speed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># The &quot;cpuSpeed&quot; setting doesn&#39;t exist on v2, so return the default.</span>
        <span class="k">if</span> <span class="n">configSettings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">configSettings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfigSettings</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpuSpeeds</span><span class="p">(</span><span class="n">configSettings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cpuSpeed&#39;</span><span class="p">,</span> <span class="mi">240</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">getNetworkPowerSave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configSettings</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getNetworkPowerSave"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getNetworkPowerSave" href="../../pixelblaze/#pixelblaze.Pixelblaze.getNetworkPowerSave">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns whether the &quot;Network Power Saving&quot; mode is enabled (and WiFi is disabled).</span>

<span class="sd">        Args:</span>
<span class="sd">            configSettings (dict, optional): If provided, extracts the value from the results of a previous call to `getConfigSettings`; otherwise, fetches the configSettings from the Pixelblaze anew. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether the &quot;Network Power Saving&quot; mode is enabled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># The &quot;networkPowerSave&quot; setting doesn&#39;t exist on v2, so return the default.</span>
        <span class="k">if</span> <span class="n">configSettings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">configSettings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfigSettings</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">configSettings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;networkPowerSave&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="c1"># --- SETTINGS menu: UPDATES settings</span>

    <span class="k">class</span> <span class="nc">updateStates</span><span class="p">(</span><span class="n">IntEnum</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.updateStates"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.updateStates" href="../../pixelblaze/#pixelblaze.Pixelblaze.updateStates">DOCS</a>
        <span class="n">unknown</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">checking</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">inProgress</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">updateError</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">upToDate</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">updateAvailable</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">updateComplete</span> <span class="o">=</span> <span class="mi">6</span>

    <span class="k">def</span> <span class="nf">getUpdateState</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">updateStates</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getUpdateState"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getUpdateState" href="../../pixelblaze/#pixelblaze.Pixelblaze.getUpdateState">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns the updateState of the Pixelblaze.</span>

<span class="sd">        Returns:</span>
<span class="sd">            updateStates: An enumeration describing the updateState of the Pixelblaze.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># We don&#39;t want to query the server every time, because changes don&#39;t happen very often.</span>
        <span class="n">checkFrequency</span> <span class="o">=</span> <span class="mi">15</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span> <span class="c1"># 15 minutes</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">latestUpdateCheck</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">latestUpdateCheck</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_in_millis</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="n">checkFrequency</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_in_millis</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">latestUpdateCheck</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">checkFrequency</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;upgradeVersion&quot;</span><span class="p">:</span> <span class="s2">&quot;check&quot;</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Get the state. If it&#39;s indeterminate, wait until it resolves.</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;getUpgradeState&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="s2">&quot;upgradeState&quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateStates</span><span class="o">.</span><span class="n">unknown</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">state</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;upgradeState&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">state</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateStates</span><span class="o">.</span><span class="n">checking</span><span class="p">:</span> <span class="k">return</span> <span class="n">state</span>
            <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;getUpgradeState&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="s2">&quot;upgradeState&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">installUpdate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">updateStates</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.installUpdate"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.installUpdate" href="../../pixelblaze/#pixelblaze.Pixelblaze.installUpdate">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Installs new Pixelblaze firmware, if the current updateState indicates that an update is available.</span>

<span class="sd">        Returns:</span>
<span class="sd">            updateStates: An enumeration describing the new updateState of the Pixelblaze.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># We can&#39;t do the update if there isn&#39;t one available.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getUpdateState</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateStates</span><span class="o">.</span><span class="n">updateAvailable</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateStates</span><span class="o">.</span><span class="n">unknown</span>
        <span class="c1"># But if there is one available, we&#39;ll give it a try.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">latestVersion</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># clear cache to force refresh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;upgradeVersion&quot;</span><span class="p">:</span> <span class="s2">&quot;update&quot;</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateStates</span><span class="o">.</span><span class="n">unknown</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getUpdateState</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">state</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]:</span> <span class="k">break</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;updateProgress: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">updateStates</span><span class="p">(</span><span class="n">state</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="c1"># --- SETTINGS menu: UPDATES section: convenience functions</span>

    <span class="k">def</span> <span class="nf">getVersion</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getVersion"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getVersion" href="../../pixelblaze/#pixelblaze.Pixelblaze.getVersion">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns the firmware version of the Pixelblaze.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: The firmware version, in major.minor format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">latestVersion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">latestVersion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfigSettings</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ver&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">latestVersion</span>

    <span class="k">def</span> <span class="nf">getVersionMajor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getVersionMajor"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getVersionMajor" href="../../pixelblaze/#pixelblaze.Pixelblaze.getVersionMajor">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns the major version number.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: A positive integer representing the integer portion of the version number (eg. for v3.24, returns 3).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getVersion</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">getVersionMinor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getVersionMinor"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getVersionMinor" href="../../pixelblaze/#pixelblaze.Pixelblaze.getVersionMinor">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns the minor version number.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: A positive integer representing the fractional portion of the version number (eg. for v3.24, returns 24).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVersion</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>

    <span class="c1"># --- SETTINGS menu: BACKUPS section</span>

    <span class="k">def</span> <span class="nf">saveBackup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.saveBackup"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.saveBackup" href="../../pixelblaze/#pixelblaze.Pixelblaze.saveBackup">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Saves the contents of this Pixelblaze into a Pixelblaze Binary Backup file.</span>

<span class="sd">        Args:</span>
<span class="sd">            fileName (str): The desired filename for the Pixelblaze Binary Backup.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">PBB</span><span class="o">.</span><span class="n">fromPixelblaze</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">toFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">restoreFromBackup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.restoreFromBackup"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.restoreFromBackup" href="../../pixelblaze/#pixelblaze.Pixelblaze.restoreFromBackup">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Restores the contents of this Pixelblaze from a Pixelblaze Binary Backup file.</span>

<span class="sd">        Args:</span>
<span class="sd">            fileName (str): The desired filename for the Pixelblaze Binary Backup.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">PBB</span><span class="o">.</span><span class="n">fromFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span><span class="o">.</span><span class="n">toPixelblaze</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reboot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.reboot"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.reboot" href="../../pixelblaze/#pixelblaze.Pixelblaze.reboot">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Reboots the Pixelblaze.</span>

<span class="sd">        This is occasionally necessary, eg. to force the Pixelblaze to recognize changes to configuration files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getUrl</span><span class="p">(</span><span class="s2">&quot;reboot&quot;</span><span class="p">),</span> <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">proxyDict</span><span class="p">)</span> <span class="k">as</span> <span class="n">rReboot</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rReboot</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">404</span><span class="p">]:</span>
                <span class="n">rReboot</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

    <span class="c1"># --- ADVANCED menu:</span>

    <span class="k">def</span> <span class="nf">setBrandName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">brandName</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setBrandName"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setBrandName" href="../../pixelblaze/#pixelblaze.Pixelblaze.setBrandName">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Sets the brand name of the Pixelblaze (used by VARs to change the brand name that appears on the webUI).</span>

<span class="sd">        Args:</span>
<span class="sd">            brandName (str): The new name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;brandName&quot;</span><span class="p">:</span> <span class="n">brandName</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setSimpleUiMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doSimpleMode</span><span class="p">:</span><span class="nb">bool</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setSimpleUiMode"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setSimpleUiMode" href="../../pixelblaze/#pixelblaze.Pixelblaze.setSimpleUiMode">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Enables or disables &quot;Simple UI Mode&quot; which makes the UI more suitable for non-technical audiences.</span>

<span class="sd">        Args:</span>
<span class="sd">            doSimpleMode (bool): Whether to enable &quot;Simple UI Mode&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;simpleUiMode&quot;</span><span class="p">:</span> <span class="n">doSimpleMode</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setLearningUiMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doLearningMode</span><span class="p">:</span><span class="nb">bool</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setLearningUiMode"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setLearningUiMode" href="../../pixelblaze/#pixelblaze.Pixelblaze.setLearningUiMode">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Enables or disables &quot;Learning UI Mode&quot; which has additional UI help for new users.</span>

<span class="sd">        Args:</span>
<span class="sd">            doSimpleMode (bool): Whether to enable &quot;Learning UI Mode&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;learningUiMode&quot;</span><span class="p">:</span> <span class="n">doLearningMode</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># --- ADVANCED menu: convenience functions</span>
    <span class="sd">&quot;&quot;&quot;The Pixelblaze API has functions to &#39;set&#39; individual property values, </span>
<span class="sd">    but can only &#39;get&#39; property values as part of a JSON dictionary containing all the settings</span>
<span class="sd">    on a particular UI page. These functions will extract the property value from a </span>
<span class="sd">    previously-fetched dictionary, if provided; otherwise they will fetch the settings anew.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">getBrandName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configSettings</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getBrandName"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getBrandName" href="../../pixelblaze/#pixelblaze.Pixelblaze.getBrandName">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns the brand name, if any, of this Pixelblaze (blank unless rebadged by a reseller).</span>

<span class="sd">        Args:</span>
<span class="sd">            configSettings (dict, optional): If provided, extracts the value from the results of a previous call to `getConfigSettings`; otherwise, fetches the configSettings from the Pixelblaze anew. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The brand name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configSettings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">configSettings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfigSettings</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">configSettings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;brandName&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getSimpleUiMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configSettings</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getSimpleUiMode"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getSimpleUiMode" href="../../pixelblaze/#pixelblaze.Pixelblaze.getSimpleUiMode">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns whether &quot;Simple UI Mode&quot; is enabled.</span>

<span class="sd">        Args:</span>
<span class="sd">            configSettings (dict, optional): If provided, extracts the value from the results of a previous call to `getConfigSettings`; otherwise, fetches the configSettings from the Pixelblaze anew. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: A boolean indicating whether &quot;Simple UI Mode&quot; is enabled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configSettings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">configSettings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfigSettings</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">configSettings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;simpleUiMode&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getLearningUiMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configSettings</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getLearningUiMode"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getLearningUiMode" href="../../pixelblaze/#pixelblaze.Pixelblaze.getLearningUiMode">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns whether &quot;Learning UI Mode&quot; is enabled.</span>

<span class="sd">        Args:</span>
<span class="sd">            configSettings (dict, optional): If provided, extracts the value from the results of a previous call to `getConfigSettings`; otherwise, fetches the configSettings from the Pixelblaze anew. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: A boolean indicating whether &quot;Learning UI Mode&quot; is enabled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configSettings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">configSettings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfigSettings</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">configSettings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;learningUiMode&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># --- PRIVATE HELPER FUNCTIONS</span>

    <span class="k">class</span> <span class="nc">deprecationReasons</span><span class="p">(</span><span class="n">IntEnum</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.deprecationReasons"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.deprecationReasons" href="../../pixelblaze/#pixelblaze.Pixelblaze.deprecationReasons">DOCS</a>
        <span class="n">renamed</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">functionalityChanged</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">notRequired</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="n">warningsGiven</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">__printDeprecationMessage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deprecationReason</span><span class="p">:</span><span class="n">deprecationReasons</span><span class="p">,</span> <span class="n">oldFunction</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">newFunction</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;For functions that have been deprecated, print an explanatory warning message the first time they are called.</span>

<span class="sd">        Args:</span>
<span class="sd">            deprecationReason (deprecationReasons): An enumerated value indicating which message to display.</span>
<span class="sd">            oldFunction (str): The old name of the function.</span>
<span class="sd">            newFunction (str): The new name of the function, where appropriate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">oldFunction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">warningsGiven</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warningsGiven</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">oldFunction</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">deprecationReason</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">deprecationReasons</span><span class="o">.</span><span class="n">renamed</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[pixelblaze-client] Warning: function &quot;</span><span class="si">{</span><span class="n">oldFunction</span><span class="si">}</span><span class="s1">&quot; has been renamed and this compatibility stub will be removed in a future release; to avoid disruption, modify your code to use the replacement function &quot;</span><span class="si">{</span><span class="n">newFunction</span><span class="si">}</span><span class="s1">&quot;.&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">deprecationReason</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">deprecationReasons</span><span class="o">.</span><span class="n">functionalityChanged</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[pixelblaze-client] Warning: function &quot;</span><span class="si">{</span><span class="n">oldFunction</span><span class="si">}</span><span class="s1">&quot; has been changed and may not have the same behavior; review the changelog and (if necessary) modify your code to use the replacement function &quot;</span><span class="si">{</span><span class="n">newFunction</span><span class="si">}</span><span class="s1">&quot;.&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">deprecationReason</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">deprecationReasons</span><span class="o">.</span><span class="n">notRequired</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[pixelblaze-client] Warning: function &quot;</span><span class="si">{</span><span class="n">oldFunction</span><span class="si">}</span><span class="s1">&quot; is no longer required and will be removed in a future release; you may safely remove it from your code.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_clamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">smallest</span><span class="p">,</span> <span class="n">largest</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Utility Method: Why doesn&#39;t Python have clamp()?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">smallest</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">largest</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_time_in_millis</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Utility Method: Returns current time in milliseconds</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>

    <span class="c1"># --- LEGACY FUNCTIONS (may be deprecated, removed or altered in the near future)</span>
    <span class="c1">#    </span>
    <span class="c1"># (Note to future editors: Some of these will probably need to stay around as a </span>
    <span class="c1"># simplified syntax &quot;convenience&quot; layer. In particular, the color control functions are handy</span>
    <span class="c1"># for home automation integrations. When deprecating or eliminating, make sure there&#39;s an</span>
    <span class="c1"># easy-to-use replacement in the current API.</span>

    <span class="k">def</span> <span class="nf">pauseRenderer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doPause</span><span class="p">:</span><span class="nb">bool</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.pauseRenderer"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.pauseRenderer" href="../../pixelblaze/#pixelblaze.Pixelblaze.pauseRenderer">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Pause rendering. Lasts until unpause() is called or the Pixelblaze is reset.</span>

<span class="sd">        CAUTION: For advanced users only.  Only used to stop the render engine before</span>
<span class="sd">        sending new bytecode.</span>

<span class="sd">        If you don&#39;t know exactly why you want to do this, DON&#39;T DO IT.</span>

<span class="sd">        Args:</span>
<span class="sd">            doPause (bool): If True, pause the render engine; if False, resume it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsSendJson</span><span class="p">({</span><span class="s2">&quot;pause&quot;</span><span class="p">:</span> <span class="n">doPause</span><span class="p">},</span> <span class="n">expectedResponse</span><span class="o">=</span><span class="s2">&quot;ack&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setActivePatternByName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patternName</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">saveToFlash</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setActivePatternByName"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setActivePatternByName" href="../../pixelblaze/#pixelblaze.Pixelblaze.setActivePatternByName">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Sets the currently running pattern using a text name.</span>

<span class="sd">        Args:</span>
<span class="sd">            patternName (str): The name of the pattern.</span>
<span class="sd">            saveToFlash (bool, optional): If True, the setting is stored in Flash memory; otherwise the value reverts on a reboot. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">patternId</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">value</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPatternList</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">())</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">patternName</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setActivePattern</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_pattern_id</span><span class="p">(</span><span class="n">patternName</span><span class="p">),</span> <span class="n">saveToFlash</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">controlExists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controlName</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">patternId</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.controlExists"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.controlExists" href="../../pixelblaze/#pixelblaze.Pixelblaze.controlExists">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Tests whether the named control exists in the specified pattern.</span>
<span class="sd">        If no pattern is specified, the currently active pattern is assumed.</span>

<span class="sd">        Note that the active pattern can be undefined on a freshly started</span>
<span class="sd">        Pixelblaze until the pattern has been explicitly set.  This function</span>
<span class="sd">        also will return False if the active pattern is not available.</span>

<span class="sd">        Args:</span>
<span class="sd">            controlName (str): The name of the control.</span>
<span class="sd">            patternId (str, optional): The pattern in which to test for the presence of the control. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the specified control exists, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getControls</span><span class="p">(</span><span class="n">patternId</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">controlName</span> <span class="ow">in</span> <span class="n">result</span> <span class="k">else</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">getColorControlNames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patternId</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getColorControlNames"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getColorControlNames" href="../../pixelblaze/#pixelblaze.Pixelblaze.getColorControlNames">DOCS</a>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of names of the specified pattern&#39;s rgbPicker or</span>
<span class="sd">        hsvPicker controls if any exist, None otherwise.  If the pattern</span>
<span class="sd">        argument is not specified, check the currently running pattern</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">controls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getControls</span><span class="p">(</span><span class="n">patternId</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">controls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># check for hsvPicker</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ctl</span><span class="p">:</span> <span class="s2">&quot;hsvPicker&quot;</span> <span class="ow">in</span> <span class="n">ctl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">controls</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
        <span class="n">ctl_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># check for rgbPicker</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ctl</span><span class="p">:</span> <span class="s2">&quot;rgbPicker&quot;</span> <span class="ow">in</span> <span class="n">ctl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">controls</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
        <span class="n">ctl_list</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">ctl_list</span> <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ctl_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">getColorControlName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patternId</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span><span id="pixelblaze.Pixelblaze.getColorControlName"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.getColorControlName" href="../../pixelblaze/#pixelblaze.Pixelblaze.getColorControlName">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns the name of the specified pattern&#39;s first rgbPicker or</span>
<span class="sd">        hsvPicker control if one exists, or None otherwise.</span>

<span class="sd">        Args:</span>
<span class="sd">            patternId (str, optional): The pattern to search for color controls; or the currently active pattern if not specified. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The name of the specified pattern&#39;s first rgbPicker or hsvPicker control if one exists, or None otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getColorControlNames</span><span class="p">(</span><span class="n">patternId</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setColorControl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controlName</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">color</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">saveToFlash</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setColorControl"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setColorControl" href="../../pixelblaze/#pixelblaze.Pixelblaze.setColorControl">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Sets the 3-element color of the specified HSV or RGB color picker.</span>

<span class="sd">        Args:</span>
<span class="sd">            controlName (str): The name of the color control to change.</span>
<span class="sd">            color (dict): A dictionary of RGB or HSV colors, with all values in the range 0-1. </span>
<span class="sd">            saveToFlash (bool, optional): If True, the setting is stored in Flash memory; otherwise the value reverts on a reboot. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># based on testing w/Pixelblaze, no run-time length or range validation is performed</span>
        <span class="c1"># on color. Pixelblaze ignores extra elements, sets unspecified elements to zero,</span>
        <span class="c1"># takes only the fractional part of elements outside the range 0-1, and</span>
        <span class="c1"># does something (1-(n % 1)) for negative elements.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setActiveControls</span><span class="p">({</span><span class="n">controlName</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span> <span class="s2">&quot;save&quot;</span><span class="p">:</span> <span class="n">saveToFlash</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">setCacheRefreshTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seconds</span><span class="p">:</span><span class="nb">int</span><span class="p">):</span><span id="pixelblaze.Pixelblaze.setCacheRefreshTime"></span><a class="mkapi-docs-link" title="pixelblaze.Pixelblaze.setCacheRefreshTime" href="../../pixelblaze/#pixelblaze.Pixelblaze.setCacheRefreshTime">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Set the interval, in seconds, after which calls to `getPatternList()` clear the pattern cache and fetch a new pattern list from the Pixelblaze.</span>

<span class="sd">        The Default is 600 seconds (10 minutes); the maximum allowable value is clamped to a million seconds (about 277 hours, or 11.5 days). Anything else would be excessive.</span>

<span class="sd">        Args:</span>
<span class="sd">            seconds (int): The maximum age of the pattern cache.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cacheRefreshInterval</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clamp</span><span class="p">(</span><span class="n">seconds</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">)</span>

<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="k">class</span> <span class="nc">PBB</span><span class="p">:</span><span id="pixelblaze.PBB"></span><a class="mkapi-docs-link" title="pixelblaze.PBB" href="../../pixelblaze/#pixelblaze.PBB">DOCS</a>
    <span class="sd">&quot;&quot;&quot;This class provides methods for importing, exporting, and manipulating the contents of a Pixelblaze Binary Backup, as created from the Settings menu on a Pixelblaze.</span>

<span class="sd">    **CREATION**</span>
<span class="sd">    - [`fromFile()`](method-fromfile)</span>
<span class="sd">    - [`fromIpAddress()`](method-fromipaddress)</span>
<span class="sd">    - [`fromPixelblaze()`](method-frompixelblaze)</span>

<span class="sd">    **PROPERTIES**</span>
<span class="sd">    - [`deviceName()`](method-devicename)</span>
<span class="sd">    - [`getFileList()`](method-getfilelist)</span>

<span class="sd">    **MANIPULATION**</span>
<span class="sd">    - [`getFile()`](method-getfile)/[`putFile()`](method-putfile)/[`deleteFile()`](method-deletefile)</span>

<span class="sd">    **PERSISTENCE**</span>
<span class="sd">    - [`toFile()`](method-tofile)</span>
<span class="sd">    - [`toIpAddress()`](method-toipaddress)</span>
<span class="sd">    - [`toPixelblaze()`](method-topixelblaze)</span>

<span class="sd">    Note: </span>
<span class="sd">        The constructor is not intended to be called directly; objects are created and returned from the object creation methods described above.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Members:</span>
    <span class="n">__textData</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">__fromDevice</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># private constructor</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">blob</span><span class="p">:</span><span class="nb">bytes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes a new Pixelblaze Binary Backup (PBB) object.</span>

<span class="sd">        Args:</span>
<span class="sd">            id (str): The patternId of the pattern.</span>
<span class="sd">            blob (bytes): The binary contents of the pattern.</span>

<span class="sd">        Note:</span>
<span class="sd">            This method is not intended to be called directly; use the static methods `fromFile()`, `fromIpAddress()` or `fromPixelblaze()` methods to create and return a Pixelblaze Binary Backup (PBB) object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__fromDevice</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__textData</span> <span class="o">=</span> <span class="n">blob</span>

    <span class="c1"># Static methods:</span>
    <span class="nd">@staticmethod</span><span id="pixelblaze.PBB.fromFile"></span><a class="mkapi-docs-link" title="pixelblaze.PBB.fromFile" href="../../pixelblaze/#pixelblaze.PBB.fromFile">DOCS</a>
    <span class="k">def</span> <span class="nf">fromFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;PBB&#39;</span><span class="p">:</span> <span class="c1"># &#39;Quoted&#39; to defer resolution of forward reference; or could use &#39;from __future__ import annotations&#39;</span>
        <span class="sd">&quot;&quot;&quot;Creates and returns a new Pixelblaze Binary Backup whose contents are loaded from a file on disk.</span>

<span class="sd">        Args:</span>
<span class="sd">            fileName (str): The filename of the Pixelblaze Binary Backup.</span>

<span class="sd">        Returns:</span>
<span class="sd">            PBB: A new Pixelblaze Binary Backup object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PBB</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>

    <span class="nd">@staticmethod</span><span id="pixelblaze.PBB.fromIpAddress"></span><a class="mkapi-docs-link" title="pixelblaze.PBB.fromIpAddress" href="../../pixelblaze/#pixelblaze.PBB.fromIpAddress">DOCS</a>
    <span class="k">def</span> <span class="nf">fromIpAddress</span><span class="p">(</span><span class="n">ipAddress</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">proxyUrl</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;PBB&#39;</span><span class="p">:</span> <span class="c1"># &#39;Quoted&#39; to defer resolution of forward reference; or could use &#39;from __future__ import annotations&#39;</span>
        <span class="sd">&quot;&quot;&quot;Creates and returns a new Pixelblaze Binary Backup whose contents are loaded from a Pixelblaze specified by IP address.</span>

<span class="sd">        Args:</span>
<span class="sd">            ipAddress (str): The Pixelblaze&#39;s IPv4 address in the usual dotted-quads numeric format (for example, &quot;192.168.4.1&quot;).</span>
<span class="sd">            proxyUrl (str, optional): The url of a proxy, if required, in the format &quot;protocol://ipAddress:port&quot; (for example, &quot;http://192.168.0.1:8888&quot;). Defaults to None.</span>
<span class="sd">            verbose (bool, optional): A boolean specifying whether to print detailed progress statements. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            PBB: A new Pixelblaze Binary Backup object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Make a connection to the Pixelblaze.</span>
        <span class="k">with</span> <span class="n">Pixelblaze</span><span class="p">(</span><span class="n">ipAddress</span><span class="p">,</span> <span class="n">proxyUrl</span><span class="o">=</span><span class="n">proxyUrl</span><span class="p">)</span> <span class="k">as</span> <span class="n">pb</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PBB</span><span class="o">.</span><span class="n">fromPixelblaze</span><span class="p">(</span><span class="n">pb</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="nd">@staticmethod</span><span id="pixelblaze.PBB.fromPixelblaze"></span><a class="mkapi-docs-link" title="pixelblaze.PBB.fromPixelblaze" href="../../pixelblaze/#pixelblaze.PBB.fromPixelblaze">DOCS</a>
    <span class="k">def</span> <span class="nf">fromPixelblaze</span><span class="p">(</span><span class="n">pb</span><span class="p">:</span><span class="n">Pixelblaze</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;PBB&#39;</span><span class="p">:</span> <span class="c1"># &#39;Quoted&#39; to defer resolution of forward reference; or could use &#39;from __future__ import annotations&#39;</span>
        <span class="sd">&quot;&quot;&quot;Creates and returns a new Pixelblaze Binary Backup whose contents are loaded from an existing Pixelblaze object.</span>

<span class="sd">        Args:</span>
<span class="sd">            pb (Pixelblaze): A Pixelblaze object.</span>
<span class="sd">            verbose (bool, optional): A boolean specifying whether to print detailed progress statements. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            PBB: A new Pixelblaze Binary Backup object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">newOne</span> <span class="o">=</span> <span class="n">PBB</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">ipAddress</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;files&quot;</span><span class="p">:</span> <span class="p">{}},</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
        <span class="c1">#   Get the file list.</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">pb</span><span class="o">.</span><span class="n">getFileList</span><span class="p">(</span><span class="n">PBB</span><span class="o">.</span><span class="n">fileTypes</span><span class="o">.</span><span class="n">fileAll</span> <span class="o">^</span> <span class="n">PBB</span><span class="o">.</span><span class="n">fileTypes</span><span class="o">.</span><span class="n">fileSystem</span><span class="p">):</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Downloading </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">getFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">contents</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">newOne</span><span class="o">.</span><span class="n">putFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">contents</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newOne</span>

    <span class="c1"># Class properties:</span>
    <span class="nd">@property</span><span id="pixelblaze.PBB.deviceName"></span><a class="mkapi-docs-link" title="pixelblaze.PBB.deviceName" href="../../pixelblaze/#pixelblaze.PBB.deviceName">DOCS</a>
    <span class="k">def</span> <span class="nf">deviceName</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets the user-friendly name of the device from which this PixelBlazeBackup was made.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The user-friendly name of the device from which this PixelBlazeBackup was made.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fromDevice</span>

    <span class="c1"># Class methods:</span>
    <span class="k">class</span> <span class="nc">fileTypes</span><span class="p">(</span><span class="n">IntFlag</span><span class="p">):</span><span id="pixelblaze.PBB.fileTypes"></span><a class="mkapi-docs-link" title="pixelblaze.PBB.fileTypes" href="../../pixelblaze/#pixelblaze.PBB.fileTypes">DOCS</a>
        <span class="sd">&quot;&quot;&quot;A Pixelblaze contains Patterns, PatternSettings, Configs, Playlists, System and Other types of files.&quot;&quot;&quot;</span>
        <span class="n">fileConfig</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">filePattern</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">filePatternSetting</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">filePlaylist</span> <span class="o">=</span> <span class="mi">8</span>
        <span class="n">fileSystem</span> <span class="o">=</span> <span class="mi">16</span>
        <span class="n">fileOther</span> <span class="o">=</span> <span class="mi">32</span>
        <span class="n">fileAll</span> <span class="o">=</span> <span class="n">fileConfig</span> <span class="o">|</span> <span class="n">filePattern</span> <span class="o">|</span> <span class="n">filePatternSetting</span> <span class="o">|</span> <span class="n">filePlaylist</span> <span class="o">|</span> <span class="n">fileSystem</span> <span class="o">|</span> <span class="n">fileOther</span>

    <span class="k">def</span> <span class="nf">getFileList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileTypes</span><span class="p">:</span><span class="n">fileTypes</span><span class="o">=</span><span class="n">fileTypes</span><span class="o">.</span><span class="n">fileAll</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span><span id="pixelblaze.PBB.getFileList"></span><a class="mkapi-docs-link" title="pixelblaze.PBB.getFileList" href="../../pixelblaze/#pixelblaze.PBB.getFileList">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns a sorted list of the files contained in this PixelBlazeBackup.</span>

<span class="sd">        Args:</span>
<span class="sd">            fileTypes (fileTypes, optional): An bitwise enumeration indicating the types of files to list. Defaults to fileTypes.fileAll.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[str]: A list of filenames.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fileList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fileName</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__textData</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8-sig&#39;</span><span class="p">))[</span><span class="s1">&#39;files&#39;</span><span class="p">]:</span>
        <span class="c1"># Filter the list depending on the fileTypes requested.</span>
            <span class="c1"># fileConfigs:</span>
            <span class="k">if</span> <span class="n">fileName</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;config.json&quot;</span><span class="p">,</span> <span class="s2">&quot;config2.json&quot;</span><span class="p">,</span> <span class="s2">&quot;obconf.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;pixelmap.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;pixelmap.dat&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">fileTypes</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileTypes</span><span class="o">.</span><span class="n">fileConfig</span><span class="p">):</span>
                    <span class="k">continue</span>
            <span class="c1"># filePatterns and filePatternSettings:</span>
            <span class="k">elif</span> <span class="n">fileName</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;/p/&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">fileName</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.c&quot;</span><span class="p">):</span>
                    <span class="c1"># filePatternSettings:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">fileTypes</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileTypes</span><span class="o">.</span><span class="n">filePatternSetting</span><span class="p">):</span>
                        <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># filePattern:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">fileTypes</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileTypes</span><span class="o">.</span><span class="n">filePattern</span><span class="p">):</span>
                        <span class="k">continue</span>
            <span class="c1"># filePlaylists:</span>
            <span class="k">elif</span> <span class="n">fileName</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;/l/&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">fileTypes</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileTypes</span><span class="o">.</span><span class="n">filePlaylist</span><span class="p">):</span>
                    <span class="k">continue</span>
            <span class="c1"># fileSystem:</span>
            <span class="k">elif</span> <span class="n">fileName</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.gz&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">fileTypes</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileTypes</span><span class="o">.</span><span class="n">fileSystem</span><span class="p">):</span>
                    <span class="k">continue</span>
            <span class="c1"># fileOthers:</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Ignore the blank line returned by the &#39;/list&#39; endpoint.</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">fileTypes</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileTypes</span><span class="o">.</span><span class="n">fileOther</span><span class="p">):</span>
                    <span class="k">continue</span>

            <span class="c1"># This file must have passed safely through all the filters.</span>
            <span class="n">fileList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>

        <span class="c1"># Return the filtered list.</span>
        <span class="n">fileList</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fileList</span>

    <span class="k">def</span> <span class="nf">getFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span><span id="pixelblaze.PBB.getFile"></span><a class="mkapi-docs-link" title="pixelblaze.PBB.getFile" href="../../pixelblaze/#pixelblaze.PBB.getFile">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Returns the contents of a particular file contained in this PixelBlazeBackup.</span>

<span class="sd">        Args:</span>
<span class="sd">            fileName (str): The name of the file to be returned.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bytes: The contents of the requested file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__textData</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8-sig&#39;</span><span class="p">))[</span><span class="s1">&#39;files&#39;</span><span class="p">][</span><span class="n">fileName</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">putFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">fileContents</span><span class="p">:</span><span class="nb">bytes</span><span class="p">):</span><span id="pixelblaze.PBB.putFile"></span><a class="mkapi-docs-link" title="pixelblaze.PBB.putFile" href="../../pixelblaze/#pixelblaze.PBB.putFile">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Inserts or replaces the contents of a particular file into this PixelBlazeBackup.</span>

<span class="sd">        Args:</span>
<span class="sd">            fileName (str): The name of the file to be stored.</span>
<span class="sd">            fileContents (bytes): The contents of the file to be stored.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">jsonContents</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__textData</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8-sig&#39;</span><span class="p">))</span>
        <span class="n">jsonContents</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;files&#39;</span><span class="p">,</span> <span class="p">{})[</span><span class="n">fileName</span><span class="p">]</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">fileContents</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__textData</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">jsonContents</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">deleteFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span><span id="pixelblaze.PBB.deleteFile"></span><a class="mkapi-docs-link" title="pixelblaze.PBB.deleteFile" href="../../pixelblaze/#pixelblaze.PBB.deleteFile">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Removes a particular file from this PixelBlazeBackup.</span>

<span class="sd">        Args:</span>
<span class="sd">            fileName (str): The name of the file to be deleted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">jsonContents</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__textData</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8-sig&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">jsonContents</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span> 
            <span class="k">del</span> <span class="n">jsonContents</span><span class="p">[</span><span class="n">fileName</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__textData</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">jsonContents</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">toFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">explode</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span><span id="pixelblaze.PBB.toFile"></span><a class="mkapi-docs-link" title="pixelblaze.PBB.toFile" href="../../pixelblaze/#pixelblaze.PBB.toFile">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Writes this Pixelblaze Binary Backup to a file on disk.</span>

<span class="sd">        Args:</span>
<span class="sd">            fileName (str, optional): If specified, the filename of the Pixelblaze Binary Backup to be created; otherwise the originating Pixelblaze name is used. Defaults to None.</span>
<span class="sd">            explode (bool, optional): If specified, also exports the files within the Pixelblaze Binary Backup to a subdirectory. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">safeFilename</span><span class="p">(</span><span class="n">unsafeName</span><span class="p">):</span>
            <span class="c1"># Sanitize filenames: Only &#39;/&#39; (U+002F SOLIDUS) is forbidden. </span>
            <span class="c1"># Other suitable candidates: &#39;&#39; (U+2044 FRACTION SLASH); &#39;&#39; (U+2215 DIVISION SLASH); &#39;&#39; (U+29F8 BIG SOLIDUS); </span>
            <span class="c1">#   &#39;&#39; (U+FF0F FULLWIDTH SOLIDUS); and &#39;&#39; (U+2571 BOX DRAWINGS LIGHT DIAGONAL UPPER RIGHT TO LOWER LEFT).</span>
            <span class="k">return</span> <span class="n">unsafeName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fileName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deviceName</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.pbb&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.pbb&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__textData</span><span class="p">)</span>
        <span class="c1"># If &#39;explode&#39; is requested, export the contents of this Pixelblaze Binary Backup (PBB) as individual files.</span>
        <span class="k">if</span> <span class="n">explode</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span> 
            <span class="c1"># Exploded files go in a subdirectory named after the Pixelblaze Binary Backup.</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Loop through the backup contents and save them appropriately.</span>
            <span class="k">for</span> <span class="n">fileName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFileList</span><span class="p">(</span><span class="n">PBB</span><span class="o">.</span><span class="n">fileTypes</span><span class="o">.</span><span class="n">fileConfig</span><span class="p">):</span>
                <span class="c1"># Config files go in the &quot;Configuration&quot; subdirectory...</span>
                <span class="n">configPath</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;Configuration/&quot;</span><span class="p">)</span>
                <span class="n">configPath</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">configPath</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">fileName</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">fileName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFileList</span><span class="p">(</span><span class="n">PBB</span><span class="o">.</span><span class="n">fileTypes</span><span class="o">.</span><span class="n">filePlaylist</span><span class="p">):</span>
                <span class="c1"># Playlists go in the &quot;Playlists&quot; subdirectory...</span>
                <span class="n">playlistPath</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;Playlists/&quot;</span><span class="p">)</span>
                <span class="n">playlistPath</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">playlistPath</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;defaultPlaylist.json&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">fileName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFileList</span><span class="p">(</span><span class="n">PBB</span><span class="o">.</span><span class="n">fileTypes</span><span class="o">.</span><span class="n">filePattern</span> <span class="o">|</span> <span class="n">PBB</span><span class="o">.</span><span class="n">fileTypes</span><span class="o">.</span><span class="n">filePatternSetting</span><span class="p">):</span>
                <span class="c1"># Patterns go in the &quot;Patterns&quot; subdirectory...</span>
                <span class="n">patternPath</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;Patterns/&quot;</span><span class="p">)</span>
                <span class="n">patternPath</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">fileName</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.c&#39;</span><span class="p">):</span>
                    <span class="c1"># For pattern settings files, get the name from the original pattern.</span>
                    <span class="n">pbp</span> <span class="o">=</span> <span class="n">PBP</span><span class="o">.</span><span class="n">fromBytes</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">fileName</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span><span class="o">.</span><span class="n">stem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]))</span>
                    <span class="n">patternPath</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">safeFilename</span><span class="p">(</span><span class="n">pbp</span><span class="o">.</span><span class="n">name</span><span class="p">))</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pbp</span> <span class="o">=</span> <span class="n">PBP</span><span class="o">.</span><span class="n">fromBytes</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">fileName</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span><span class="o">.</span><span class="n">stem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">))</span>
                    <span class="n">pbpPath</span> <span class="o">=</span> <span class="n">patternPath</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">safeFilename</span><span class="p">(</span><span class="n">pbp</span><span class="o">.</span><span class="n">name</span><span class="p">))</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.pbp&#39;</span><span class="p">)</span>
                    <span class="n">pbp</span><span class="o">.</span><span class="n">toFile</span><span class="p">(</span><span class="n">pbpPath</span><span class="p">)</span>
                    <span class="n">pbp</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="n">pbpPath</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">fileName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFileList</span><span class="p">(</span><span class="n">PBB</span><span class="o">.</span><span class="n">fileTypes</span><span class="o">.</span><span class="n">fileOther</span><span class="p">):</span>
                <span class="c1"># And everything else (should just be the Icons) goes in the root directory...</span>
                <span class="n">path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">fileName</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">toIpAddress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ipAddress</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">proxyUrl</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span><span id="pixelblaze.PBB.toIpAddress"></span><a class="mkapi-docs-link" title="pixelblaze.PBB.toIpAddress" href="../../pixelblaze/#pixelblaze.PBB.toIpAddress">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Restores the contents of this PixelBlazeBackup to a Pixelblaze identified by IP Address.</span>

<span class="sd">        Args:</span>
<span class="sd">            ipAddress (str): The Pixelblaze&#39;s IPv4 address in the usual dotted-quads numeric format (for example, &quot;192.168.4.1&quot;)..</span>
<span class="sd">            proxyUrl (str, optional): The url of a proxy, if required, in the format &quot;protocol://ipAddress:port&quot; (for example, &quot;http://192.168.0.1:8888&quot;). Defaults to None.</span>
<span class="sd">            verbose (bool, optional): A boolean specifying whether to print detailed progress statements. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Make a connection to the Pixelblaze.</span>
        <span class="k">with</span> <span class="n">Pixelblaze</span><span class="p">(</span><span class="n">ipAddress</span><span class="p">,</span> <span class="n">proxyUrl</span><span class="o">=</span><span class="n">proxyUrl</span><span class="p">)</span> <span class="k">as</span> <span class="n">pb</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toPixelblaze</span><span class="p">(</span><span class="n">pb</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">toPixelblaze</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pb</span><span class="p">:</span><span class="n">Pixelblaze</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span><span id="pixelblaze.PBB.toPixelblaze"></span><a class="mkapi-docs-link" title="pixelblaze.PBB.toPixelblaze" href="../../pixelblaze/#pixelblaze.PBB.toPixelblaze">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Uploads the contents of this PixelBlazeBackup to the destination Pixelblaze.</span>

<span class="sd">        Args:</span>
<span class="sd">            pb (Pixelblaze): A Pixelblaze object.</span>
<span class="sd">            verbose (bool, optional): A boolean specifying whether to print detailed progress statements. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Delete all the files that are currently loaded on the Pixelblaze (excepting the WebApp itself).</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">pb</span><span class="o">.</span><span class="n">getFileList</span><span class="p">(</span><span class="n">PBB</span><span class="o">.</span><span class="n">fileTypes</span><span class="o">.</span><span class="n">fileAll</span> <span class="o">^</span> <span class="n">PBB</span><span class="o">.</span><span class="n">fileTypes</span><span class="o">.</span><span class="n">fileSystem</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Deleting </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">pb</span><span class="o">.</span><span class="n">deleteFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="c1"># Upload everything that&#39;s in this PixelBlazeBackup to the Pixelblaze.</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFileList</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Uploading </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">pb</span><span class="o">.</span><span class="n">putFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFile</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="c1"># Send a reboot command so the Pixelblaze will recognize the new configuration.</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Rebooting </span><span class="si">{</span><span class="n">pb</span><span class="o">.</span><span class="n">ipAddress</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">pb</span><span class="o">.</span><span class="n">reboot</span><span class="p">()</span>

<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="k">class</span> <span class="nc">PBP</span><span class="p">:</span><span id="pixelblaze.PBP"></span><a class="mkapi-docs-link" title="pixelblaze.PBP" href="../../pixelblaze/#pixelblaze.PBP">DOCS</a>
    <span class="sd">&quot;&quot;&quot;This class represents a Pixelblaze Binary Pattern, as stored on the Pixelblaze filesystem or contained in a Pixelblaze Binary Backup.</span>

<span class="sd">    **CREATION**</span>
<span class="sd">    - [`fromBytes()`](method-frombytes)</span>
<span class="sd">    - [`fromFile()`](method-fromfile)</span>
<span class="sd">    - [`fromIpAddress()`](method-fromipaddress)</span>
<span class="sd">    - [`fromPixelblaze()`](method-frompixelblaze)</span>

<span class="sd">    **PROPERTIES**</span>
<span class="sd">    - [`id()`](method-id)</span>
<span class="sd">    - [`name()`](method-name)</span>
<span class="sd">    - [`jpeg()`](method-jpeg)</span>
<span class="sd">    - [`byteCode()`](method-bytecode)</span>
<span class="sd">    - [`sourceCode()`](method-sourcecode)</span>

<span class="sd">    **PERSISTENCE**</span>
<span class="sd">    - [`toFile()`](method-tofile)</span>
<span class="sd">    - [`toIpAddress()`](method-toipaddress)</span>
<span class="sd">    - [`toPixelblaze()`](method-topixelblaze)</span>
<span class="sd">    - [`toEPE()`](method-toepe)</span>
<span class="sd">    - [`explode()`](method-explode)</span>


<span class="sd">    Note: </span>
<span class="sd">        The constructor is not intended to be called directly; objects are created and returned from the object creation methods described above.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Members:</span>
    <span class="n">__id</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">__binaryData</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># The first 9 DWORDs of the binaryData is a header containing offsets to the components:</span>
        <span class="c1">#   0=version, </span>
        <span class="c1">#   1=nameOffset, 2=nameLength, </span>
        <span class="c1">#   3=jpegOffset, 4=jpegLength,</span>
        <span class="c1">#   5=bytecodeOffset, 6=bytecodeLength,</span>
        <span class="c1">#   7=sourceOffset, 8=sourceLength</span>

    <span class="c1"># private constructor</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">blob</span><span class="p">:</span><span class="nb">bytes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes a new Pixelblaze Binary Pattern (PBP) object.</span>

<span class="sd">        Args:</span>
<span class="sd">            id (str): The patternId of the pattern.</span>
<span class="sd">            blob (bytes): The binary contents of the pattern.</span>

<span class="sd">        Note:</span>
<span class="sd">            This method is not intended to be called directly; use the static methods `fromBytes()`, `fromFile()`, `fromIpAddress()` or `fromPixelblaze()` methods to create and return a PBP object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__binaryData</span> <span class="o">=</span> <span class="n">blob</span>

    <span class="c1"># Static methods:</span>
    <span class="nd">@staticmethod</span><span id="pixelblaze.PBP.fromBytes"></span><a class="mkapi-docs-link" title="pixelblaze.PBP.fromBytes" href="../../pixelblaze/#pixelblaze.PBP.fromBytes">DOCS</a>
    <span class="k">def</span> <span class="nf">fromBytes</span><span class="p">(</span><span class="n">patternId</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">blob</span><span class="p">:</span><span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;PBP&#39;</span><span class="p">:</span> <span class="c1"># &#39;Quoted&#39; to defer resolution of forward reference; or could use &#39;from __future__ import annotations&#39;</span>
        <span class="sd">&quot;&quot;&quot;Creates and returns a new Pixelblaze Binary Pattern (PBP) whose contents are initialized from a bytes array.</span>

<span class="sd">        Args:</span>
<span class="sd">            patternId (str): A patternId for the Pixelblaze Binary Pattern to be created.</span>
<span class="sd">            blob (bytes): The binary contents of the Pixelblaze Binary Pattern to be created.</span>

<span class="sd">        Returns:</span>
<span class="sd">            PBP: A new Pixelblaze Binary Pattern object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PBP</span><span class="p">(</span><span class="n">patternId</span><span class="p">,</span> <span class="n">blob</span><span class="p">)</span>

    <span class="nd">@staticmethod</span><span id="pixelblaze.PBP.fromFile"></span><a class="mkapi-docs-link" title="pixelblaze.PBP.fromFile" href="../../pixelblaze/#pixelblaze.PBP.fromFile">DOCS</a>
    <span class="k">def</span> <span class="nf">fromFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;PBP&#39;</span><span class="p">:</span> <span class="c1"># &#39;Quoted&#39; to defer resolution of forward reference; or could use &#39;from __future__ import annotations&#39;</span>
        <span class="sd">&quot;&quot;&quot;Creates and returns a new Pixelblaze Binary Pattern (PBP) whose contents are loaded from a file on disk.</span>

<span class="sd">        Args:</span>
<span class="sd">            fileName (str): The name of the file to be loaded into a Pixelblaze Binary Pattern.</span>

<span class="sd">        Returns:</span>
<span class="sd">            PBP: A new Pixelblaze Binary Pattern object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PBP</span><span class="o">.</span><span class="n">fromBytes</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">())</span>

    <span class="nd">@staticmethod</span><span id="pixelblaze.PBP.fromIpAddress"></span><a class="mkapi-docs-link" title="pixelblaze.PBP.fromIpAddress" href="../../pixelblaze/#pixelblaze.PBP.fromIpAddress">DOCS</a>
    <span class="k">def</span> <span class="nf">fromIpAddress</span><span class="p">(</span><span class="n">ipAddress</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">patternId</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">proxyUrl</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;PBP&#39;</span><span class="p">:</span> <span class="c1"># &#39;Quoted&#39; to defer resolution of forward reference; or could use &#39;from __future__ import annotations&#39;</span>
        <span class="sd">&quot;&quot;&quot;Creates and returns a new pattern Pixelblaze Binary Pattern (PBP) whose contents are downloaded from a URL.</span>

<span class="sd">        Args:</span>
<span class="sd">            ipAddress (str): The Pixelblaze&#39;s IPv4 address in the usual dotted-quads numeric format (for example, &quot;192.168.4.1&quot;).</span>
<span class="sd">            patternId (str): The patternId of the Pixelblaze Binary Pattern to be loaded from the Pixelblaze.</span>
<span class="sd">            proxyUrl (str, optional): The url of a proxy, if required, in the format &quot;protocol://ipAddress:port&quot; (for example, &quot;http://192.168.0.1:8888&quot;). Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            PBP: A new Pixelblaze Binary Pattern object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Make a connection to the Pixelblaze.</span>
        <span class="k">with</span> <span class="n">Pixelblaze</span><span class="p">(</span><span class="n">ipAddress</span><span class="p">,</span> <span class="n">proxyUrl</span><span class="o">=</span><span class="n">proxyUrl</span><span class="p">)</span> <span class="k">as</span> <span class="n">pb</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PBP</span><span class="o">.</span><span class="n">fromPixelblaze</span><span class="p">(</span><span class="n">pb</span><span class="p">,</span> <span class="n">patternId</span><span class="p">)</span>

    <span class="nd">@staticmethod</span><span id="pixelblaze.PBP.fromPixelblaze"></span><a class="mkapi-docs-link" title="pixelblaze.PBP.fromPixelblaze" href="../../pixelblaze/#pixelblaze.PBP.fromPixelblaze">DOCS</a>
    <span class="k">def</span> <span class="nf">fromPixelblaze</span><span class="p">(</span><span class="n">pb</span><span class="p">:</span><span class="n">Pixelblaze</span><span class="p">,</span> <span class="n">patternId</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;PBP&#39;</span><span class="p">:</span> <span class="c1"># &#39;Quoted&#39; to defer resolution of forward reference; or could use &#39;from __future__ import annotations&#39;</span>
        <span class="sd">&quot;&quot;&quot;Creates and returns a new pattern Pixelblaze Binary Pattern (PBP) whose contents are downloaded from an active Pixelblaze object.</span>

<span class="sd">        Args:</span>
<span class="sd">            pb (Pixelblaze): An active Pixelblaze object.</span>
<span class="sd">            patternId (str): The patternId of the Pixelblaze Binary Pattern to be loaded from the Pixelblaze.</span>

<span class="sd">        Returns:</span>
<span class="sd">            PBP: A new Pixelblaze Binary Pattern object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PBP</span><span class="o">.</span><span class="n">fromBytes</span><span class="p">(</span><span class="n">patternId</span><span class="p">,</span> <span class="n">pb</span><span class="o">.</span><span class="n">getFile</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/p/</span><span class="si">{</span><span class="n">patternId</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>

    <span class="c1"># Class properties:</span>
    <span class="nd">@property</span><span id="pixelblaze.PBP.id"></span><a class="mkapi-docs-link" title="pixelblaze.PBP.id" href="../../pixelblaze/#pixelblaze.PBP.id">DOCS</a>
    <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns the patternId of the pattern contained in this Pixelblaze Binary Pattern (PBP).</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The patternId of the pattern contained in this Pixelblaze Binary Pattern (PBP).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__id</span>

    <span class="nd">@property</span><span id="pixelblaze.PBP.name"></span><a class="mkapi-docs-link" title="pixelblaze.PBP.name" href="../../pixelblaze/#pixelblaze.PBP.name">DOCS</a>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns the (human-readable) name of the pattern contained in this Pixelblaze Binary Pattern (PBP).</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The (human-readable) name of the pattern contained in this Pixelblaze Binary Pattern (PBP).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate the offset for this component.</span>
        <span class="n">offsets</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&lt;9I&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__binaryData</span><span class="p">[:</span><span class="mi">36</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__binaryData</span><span class="p">[</span><span class="n">offsets</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">offsets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">offsets</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span>

    <span class="nd">@property</span><span id="pixelblaze.PBP.jpeg"></span><a class="mkapi-docs-link" title="pixelblaze.PBP.jpeg" href="../../pixelblaze/#pixelblaze.PBP.jpeg">DOCS</a>
    <span class="k">def</span> <span class="nf">jpeg</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns (as a collection of bytes) the preview JPEG of the pattern contained in this Pixelblaze Binary Pattern (PBP).</span>

<span class="sd">        Returns:</span>
<span class="sd">            bytes: The preview JPEG of the pattern contained in this Pixelblaze Binary Pattern (PBP).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate the offset for this component.</span>
        <span class="n">offsets</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&lt;9I&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__binaryData</span><span class="p">[:</span><span class="mi">36</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__binaryData</span><span class="p">[</span><span class="n">offsets</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span><span class="n">offsets</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="n">offsets</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span>

    <span class="nd">@property</span><span id="pixelblaze.PBP.byteCode"></span><a class="mkapi-docs-link" title="pixelblaze.PBP.byteCode" href="../../pixelblaze/#pixelblaze.PBP.byteCode">DOCS</a>
    <span class="k">def</span> <span class="nf">byteCode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns (as a collection of bytes) the bytecode of the pattern contained in this Pixelblaze Binary Pattern (PBP).</span>

<span class="sd">        Returns:</span>
<span class="sd">            bytes: The bytecode of the pattern contained in this Pixelblaze Binary Pattern (PBP).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate the offset for this component.</span>
        <span class="n">offsets</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&lt;9I&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__binaryData</span><span class="p">[:</span><span class="mi">36</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__binaryData</span><span class="p">[</span><span class="n">offsets</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span><span class="n">offsets</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">+</span><span class="n">offsets</span><span class="p">[</span><span class="mi">6</span><span class="p">]]</span>

    <span class="nd">@property</span><span id="pixelblaze.PBP.sourceCode"></span><a class="mkapi-docs-link" title="pixelblaze.PBP.sourceCode" href="../../pixelblaze/#pixelblaze.PBP.sourceCode">DOCS</a>
    <span class="k">def</span> <span class="nf">sourceCode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns the source code of the pattern in this Pixelblaze Binary Pattern (PBP).</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The source code of the pattern as a JSON-encoded string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate the offset for this component.</span>
        <span class="n">offsets</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&lt;9I&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__binaryData</span><span class="p">[:</span><span class="mi">36</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">_LZstring</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__binaryData</span><span class="p">[</span><span class="n">offsets</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span><span class="n">offsets</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">+</span><span class="n">offsets</span><span class="p">[</span><span class="mi">8</span><span class="p">]])</span>

    <span class="c1"># Class methods:</span>
    <span class="k">def</span> <span class="nf">toFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span><span id="pixelblaze.PBP.toFile"></span><a class="mkapi-docs-link" title="pixelblaze.PBP.toFile" href="../../pixelblaze/#pixelblaze.PBP.toFile">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Saves this Pixelblaze Binary Pattern (PBP) to a file on disk.</span>

<span class="sd">        Args:</span>
<span class="sd">            fileName (str, optional): If provided, A name for the Pixelblaze Binary Pattern file to be created; otherwise, the name is derived from the patternId. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fileName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.pbp&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.pbp&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__binaryData</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">toIpAddress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ipAddress</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">proxyUrl</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span><span id="pixelblaze.PBP.toIpAddress"></span><a class="mkapi-docs-link" title="pixelblaze.PBP.toIpAddress" href="../../pixelblaze/#pixelblaze.PBP.toIpAddress">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Uploads this Pixelblaze Binary Pattern (PBP) to a Pixelblaze identified by its IP address.</span>

<span class="sd">        Args:</span>
<span class="sd">            ipAddress (str): The Pixelblaze&#39;s IPv4 address in the usual dotted-quads numeric format (for example, &quot;192.168.4.1&quot;).</span>
<span class="sd">            proxyUrl (str, optional): The url of a proxy, if required, in the format &quot;protocol://ipAddress:port&quot; (for example, &quot;http://192.168.0.1:8888&quot;). Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Make a connection to the Pixelblaze.</span>
        <span class="k">with</span> <span class="n">Pixelblaze</span><span class="p">(</span><span class="n">ipAddress</span><span class="p">,</span> <span class="n">proxyUrl</span><span class="p">)</span> <span class="k">as</span> <span class="n">pb</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toPixelblaze</span><span class="p">(</span><span class="n">pb</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">toPixelblaze</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pb</span><span class="p">:</span><span class="n">Pixelblaze</span><span class="p">):</span><span id="pixelblaze.PBP.toPixelblaze"></span><a class="mkapi-docs-link" title="pixelblaze.PBP.toPixelblaze" href="../../pixelblaze/#pixelblaze.PBP.toPixelblaze">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Uploads this Pixelblaze Binary Pattern (PBP) to an active Pixelblaze object.</span>

<span class="sd">        Args:</span>
<span class="sd">            pb (Pixelblaze): An active Pixelblaze object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pb</span><span class="o">.</span><span class="n">putFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__binaryData</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">toEPE</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;EPE&#39;</span><span class="p">:</span> <span class="c1"># &#39;Quoted&#39; to defer resolution of forward reference; or could use &#39;from __future__ import annotations&#39;</span><span id="pixelblaze.PBP.toEPE"></span><a class="mkapi-docs-link" title="pixelblaze.PBP.toEPE" href="../../pixelblaze/#pixelblaze.PBP.toEPE">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Creates a new Electromage Pattern Export (EPE) and initializes it from the contents of this Pixelblaze Binary Pattern (PBP).</span>

<span class="sd">        Returns:</span>
<span class="sd">            EPE: A new Electromage Pattern Export object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">epe</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;sources&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sourceCode</span><span class="p">),</span>
            <span class="s1">&#39;preview&#39;</span><span class="p">:</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jpeg</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">EPE</span><span class="o">.</span><span class="n">fromBytes</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">epe</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">explode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span><span id="pixelblaze.PBP.explode"></span><a class="mkapi-docs-link" title="pixelblaze.PBP.explode" href="../../pixelblaze/#pixelblaze.PBP.explode">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Exports all the components of this Pixelblaze Binary Pattern (PBP) as separate files.</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str, optional): If provided, a pathname for the folder in which to export the components; otherwise derived from the patternId. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get a Path to help with creating filenames.</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">patternPath</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c1"># ...the human-readable name.</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">patternPath</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.metadata&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># ...the preview image.</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">patternPath</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.jpg&#39;</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jpeg</span><span class="p">)</span>

        <span class="c1"># ...the human-readable source code.</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">patternPath</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.js&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sourceCode</span><span class="p">)[</span><span class="s1">&#39;main&#39;</span><span class="p">])</span>

        <span class="c1"># ...the bytecode.</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">patternPath</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.bytecode&#39;</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">byteCode</span><span class="p">)</span>

        <span class="c1"># and combine the above into a portable JSON archive (.EPE)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toEPE</span><span class="p">()</span><span class="o">.</span><span class="n">toFile</span><span class="p">(</span><span class="n">patternPath</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.epe&#39;</span><span class="p">))</span>

<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="k">class</span> <span class="nc">EPE</span><span class="p">:</span><span id="pixelblaze.EPE"></span><a class="mkapi-docs-link" title="pixelblaze.EPE" href="../../pixelblaze/#pixelblaze.EPE">DOCS</a>
    <span class="sd">&quot;&quot;&quot;This class provides methods for importing, exporting, and manipulating the contents of an Electromage Pattern Export (EPE), as exported from the Patterns list on a Pixelblaze.</span>

<span class="sd">    **CREATION**</span>
<span class="sd">    - [`fromBytes()`](method-frombytes)</span>
<span class="sd">    - [`fromFile()`](method-fromfile)</span>

<span class="sd">    **PROPERTIES**</span>
<span class="sd">    - [`patternId()`](method-patternid)</span>
<span class="sd">    - [`patternName()`](method-patternname)</span>
<span class="sd">    - [`sourceCode()`](method-sourcecode)</span>
<span class="sd">    - [`previewImage()`](method-previewimage)</span>

<span class="sd">    **PERSISTENCE**</span>
<span class="sd">    - [`toFile()`](method-tofile)</span>
<span class="sd">    - [`explode()`](method-explode)</span>

<span class="sd">    Note: </span>
<span class="sd">        The constructor is not intended to be called directly; objects are created and returned from the object creation methods described above.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Members:</span>
    <span class="n">__textData</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># private constructor</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">blob</span><span class="p">:</span><span class="nb">bytes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes a new Electromage Pattern Export (EPE) object.</span>

<span class="sd">        Args:</span>
<span class="sd">            blob (bytes): The contents of the Electromage Pattern Export (EPE).</span>

<span class="sd">        Note:</span>
<span class="sd">            This method is not intended to be called directly; use the static methods `fromBytes()` or `fromFile()` to create and return an Electromage Pattern Export object. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__textData</span> <span class="o">=</span> <span class="n">blob</span>

    <span class="c1"># Static methods:</span>
    <span class="nd">@staticmethod</span><span id="pixelblaze.EPE.fromBytes"></span><a class="mkapi-docs-link" title="pixelblaze.EPE.fromBytes" href="../../pixelblaze/#pixelblaze.EPE.fromBytes">DOCS</a>
    <span class="k">def</span> <span class="nf">fromBytes</span><span class="p">(</span><span class="n">blob</span><span class="p">:</span><span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;EPE&#39;</span><span class="p">:</span> <span class="c1"># &#39;Quoted&#39; to defer resolution of forward reference; or could use &#39;from __future__ import annotations&#39;</span>
        <span class="sd">&quot;&quot;&quot;Creates and returns a new Electromage Pattern Export (EPE) whose contents are loaded from a bytes array.</span>

<span class="sd">        Args:</span>
<span class="sd">            blob (bytes): The data from which to create the Electromage Pattern Export (EPE).</span>

<span class="sd">        Returns:</span>
<span class="sd">            EPE: A new Electromage Pattern Export (EPE) object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">EPE</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>

    <span class="nd">@staticmethod</span><span id="pixelblaze.EPE.fromFile"></span><a class="mkapi-docs-link" title="pixelblaze.EPE.fromFile" href="../../pixelblaze/#pixelblaze.EPE.fromFile">DOCS</a>
    <span class="k">def</span> <span class="nf">fromFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;EPE&#39;</span><span class="p">:</span> <span class="c1"># &#39;Quoted&#39; to defer resolution of forward reference; or could use &#39;from __future__ import annotations&#39;</span>
        <span class="sd">&quot;&quot;&quot;Creates and returns a new portable pattern EPE whose contents are loaded from a file on disk.</span>

<span class="sd">        Args:</span>
<span class="sd">            fileName (str): The name of the file from which to create the Electromage Pattern Export (EPE).</span>

<span class="sd">        Returns:</span>
<span class="sd">            EPE: A new Electromage Pattern Export (EPE) object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">EPE</span><span class="o">.</span><span class="n">fromBytes</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

    <span class="c1"># Class properties:</span>
    <span class="nd">@property</span><span id="pixelblaze.EPE.patternId"></span><a class="mkapi-docs-link" title="pixelblaze.EPE.patternId" href="../../pixelblaze/#pixelblaze.EPE.patternId">DOCS</a>
    <span class="k">def</span> <span class="nf">patternId</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns the patternId of the pattern contained in this Electromage Pattern Export (EPE).</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The patternId of the pattern contained in this Electromage Pattern Export (EPE).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__textData</span><span class="p">)[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>

    <span class="nd">@property</span><span id="pixelblaze.EPE.patternName"></span><a class="mkapi-docs-link" title="pixelblaze.EPE.patternName" href="../../pixelblaze/#pixelblaze.EPE.patternName">DOCS</a>
    <span class="k">def</span> <span class="nf">patternName</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns the human-readable name of the pattern in this Electromage Pattern Export (EPE).</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The human-readable name of the pattern contained in this Electromage Pattern Export (EPE).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__textData</span><span class="p">)[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

    <span class="nd">@property</span><span id="pixelblaze.EPE.sourceCode"></span><a class="mkapi-docs-link" title="pixelblaze.EPE.sourceCode" href="../../pixelblaze/#pixelblaze.EPE.sourceCode">DOCS</a>
    <span class="k">def</span> <span class="nf">sourceCode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns the source code of the pattern contained in this Electromage Pattern Export (EPE).</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The sourceCode of the pattern contained in this Electromage Pattern Export (EPE).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if @wizard ever implements code sharing this may need to change (remove [&#39;main&#39;]?).</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__textData</span><span class="p">)[</span><span class="s1">&#39;sources&#39;</span><span class="p">][</span><span class="s1">&#39;main&#39;</span><span class="p">]</span>

    <span class="nd">@property</span><span id="pixelblaze.EPE.previewImage"></span><a class="mkapi-docs-link" title="pixelblaze.EPE.previewImage" href="../../pixelblaze/#pixelblaze.EPE.previewImage">DOCS</a>
    <span class="k">def</span> <span class="nf">previewImage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns (as bytes) the preview JPEG of the pattern contained in this Electromage Pattern Export (EPE).</span>

<span class="sd">        Returns:</span>
<span class="sd">            bytes: The preview JPEG of the pattern contained in this Electromage Pattern Export (EPE).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__textData</span><span class="p">)[</span><span class="s1">&#39;preview&#39;</span><span class="p">]</span>

    <span class="c1"># Class methods:</span>
    <span class="k">def</span> <span class="nf">toFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span><span id="pixelblaze.EPE.toFile"></span><a class="mkapi-docs-link" title="pixelblaze.EPE.toFile" href="../../pixelblaze/#pixelblaze.EPE.toFile">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Saves this Electromage Pattern Export (EPE) to a file on disk.</span>

<span class="sd">        Args:</span>
<span class="sd">            fileName (str, optional): If provided, a name for the file to be created; otherwise derived from the patternId. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fileName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fileName</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patternId</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.epe&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__textData</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">explode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span><span id="pixelblaze.EPE.explode"></span><a class="mkapi-docs-link" title="pixelblaze.EPE.explode" href="../../pixelblaze/#pixelblaze.EPE.explode">DOCS</a>
        <span class="sd">&quot;&quot;&quot;Exports the components of this Electromage Pattern Export (EPE) to separate files.</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str): If provided, a pathname for the folder in which to export the components; otherwise derived from the patternId. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get a Path to help with creating filenames.</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patternId</span><span class="p">)</span>
        <span class="n">patternPath</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c1"># ...the human-readable name.</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">patternPath</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.metadata&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patternName</span><span class="p">)</span>

        <span class="c1"># ...the preview image.</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">patternPath</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.jpg&#39;</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">previewImage</span><span class="p">)</span>

        <span class="c1"># ...the human-readable source code.</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">patternPath</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.js&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sourceCode</span><span class="p">)</span>

<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="k">class</span> <span class="nc">_LZstring</span><span class="p">:</span>
    <span class="c1"># LZstring code borrowed (and truncated) from https://github.com/marcel-dancak/lz-string-python, which</span>
    <span class="c1"># on a cursory examination seems to be largely a copy of https://github.com/eduardtomasek/lz-string-python,</span>
    <span class="c1"># which has been forked to https://github.com/gkovacs/lz-string-python and published in PyPi as lzstring 1.0.4,</span>
    <span class="c1"># but which has unresolved merge issues with the parent repository, so who do you trust? Might as well </span>
    <span class="c1"># keep a private copy until somebody sorts it out.</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">decompress</span><span class="p">(</span><span class="n">compressed</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">compressed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">compressed</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>

        <span class="n">resetValue</span> <span class="o">=</span> <span class="mi">128</span>
        <span class="n">dictionary</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">enlargeIn</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">dictSize</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">numBits</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">entry</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">val</span><span class="o">=</span><span class="n">compressed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">position</span><span class="o">=</span><span class="n">resetValue</span>
        <span class="n">index</span><span class="o">=</span><span class="mi">1</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span> <span class="n">dictionary</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>

        <span class="n">bits</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">maxpower</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">power</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">while</span> <span class="n">power</span> <span class="o">!=</span> <span class="n">maxpower</span><span class="p">:</span>
            <span class="n">resb</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&amp;</span> <span class="n">position</span>
            <span class="n">position</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">position</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">position</span> <span class="o">=</span> <span class="n">resetValue</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">compressed</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">bits</span> <span class="o">|=</span> <span class="n">power</span> <span class="k">if</span> <span class="n">resb</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">power</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>

        <span class="nb">next</span> <span class="o">=</span> <span class="n">bits</span>
        <span class="k">if</span> <span class="nb">next</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">bits</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">maxpower</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
            <span class="n">power</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="n">power</span> <span class="o">!=</span> <span class="n">maxpower</span><span class="p">:</span>
                <span class="n">resb</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&amp;</span> <span class="n">position</span>
                <span class="n">position</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">position</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">position</span> <span class="o">=</span> <span class="n">resetValue</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">compressed</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">bits</span> <span class="o">|=</span> <span class="n">power</span> <span class="k">if</span> <span class="n">resb</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="n">power</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
            <span class="n">c</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">next</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">bits</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">maxpower</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
            <span class="n">power</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="n">power</span> <span class="o">!=</span> <span class="n">maxpower</span><span class="p">:</span>
                <span class="n">resb</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&amp;</span> <span class="n">position</span>
                <span class="n">position</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">position</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">position</span> <span class="o">=</span> <span class="n">resetValue</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">compressed</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">bits</span> <span class="o">|=</span> <span class="n">power</span> <span class="k">if</span> <span class="n">resb</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="n">power</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
            <span class="n">c</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">next</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="n">dictionary</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">c</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">compressed</span><span class="p">):</span> <span class="k">return</span> <span class="s2">&quot;&quot;</span>

            <span class="n">bits</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">maxpower</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">numBits</span><span class="p">)</span>
            <span class="n">power</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="n">power</span> <span class="o">!=</span> <span class="n">maxpower</span><span class="p">:</span>
                <span class="n">resb</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&amp;</span> <span class="n">position</span>
                <span class="n">position</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">position</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">position</span> <span class="o">=</span> <span class="n">resetValue</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">compressed</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">bits</span> <span class="o">|=</span> <span class="n">power</span> <span class="k">if</span> <span class="n">resb</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="n">power</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>

            <span class="n">c</span> <span class="o">=</span> <span class="n">bits</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">bits</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">maxpower</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
                <span class="n">power</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">while</span> <span class="n">power</span> <span class="o">!=</span> <span class="n">maxpower</span><span class="p">:</span>
                    <span class="n">resb</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&amp;</span> <span class="n">position</span>
                    <span class="n">position</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">position</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">position</span> <span class="o">=</span> <span class="n">resetValue</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="n">compressed</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">bits</span> <span class="o">|=</span> <span class="n">power</span> <span class="k">if</span> <span class="n">resb</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
                    <span class="n">power</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>

                <span class="n">dictionary</span><span class="p">[</span><span class="n">dictSize</span><span class="p">]</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span>
                <span class="n">dictSize</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">dictSize</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">enlargeIn</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">bits</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">maxpower</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
                <span class="n">power</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">while</span> <span class="n">power</span> <span class="o">!=</span> <span class="n">maxpower</span><span class="p">:</span>
                    <span class="n">resb</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&amp;</span> <span class="n">position</span>
                    <span class="n">position</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">position</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">position</span> <span class="o">=</span> <span class="n">resetValue</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="n">compressed</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">bits</span> <span class="o">|=</span> <span class="n">power</span> <span class="k">if</span> <span class="n">resb</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
                    <span class="n">power</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
                <span class="n">dictionary</span><span class="p">[</span><span class="n">dictSize</span><span class="p">]</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span>
                <span class="n">dictSize</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">dictSize</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">enlargeIn</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">enlargeIn</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">enlargeIn</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">numBits</span><span class="p">)</span>
                <span class="n">numBits</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="p">:</span> <span class="n">entry</span> <span class="o">=</span> <span class="n">dictionary</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">dictSize</span><span class="p">:</span> <span class="n">entry</span> <span class="o">=</span> <span class="n">w</span> <span class="o">+</span> <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

            <span class="c1"># Add w+entry[0] to the dictionary.</span>
            <span class="n">dictionary</span><span class="p">[</span><span class="n">dictSize</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span> <span class="o">+</span> <span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">dictSize</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">enlargeIn</span> <span class="o">-=</span> <span class="mi">1</span>

            <span class="n">w</span> <span class="o">=</span> <span class="n">entry</span>
            <span class="k">if</span> <span class="n">enlargeIn</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">enlargeIn</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">numBits</span><span class="p">)</span>
                <span class="n">numBits</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">compress</span><span class="p">(</span><span class="n">uncompressed</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">uncompressed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="n">bitsPerChar</span> <span class="o">=</span> <span class="mi">16</span>
        <span class="n">getCharFromInt</span> <span class="o">=</span> <span class="nb">chr</span>
        <span class="n">context_dictionary</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">context_dictionaryToCreate</span><span class="o">=</span> <span class="p">{}</span>
        <span class="n">context_c</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">context_wc</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">context_w</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">context_enlargeIn</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># Compensate for the first entry which should not count</span>
        <span class="n">context_dictSize</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">context_numBits</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">context_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">context_data_val</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">context_data_position</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uncompressed</span><span class="p">)):</span>
            <span class="n">context_c</span> <span class="o">=</span> <span class="n">uncompressed</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">context_c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">context_dictionary</span><span class="p">:</span>
                <span class="n">context_dictionary</span><span class="p">[</span><span class="n">context_c</span><span class="p">]</span> <span class="o">=</span> <span class="n">context_dictSize</span>
                <span class="n">context_dictSize</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">context_dictionaryToCreate</span><span class="p">[</span><span class="n">context_c</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">context_wc</span> <span class="o">=</span> <span class="n">context_w</span> <span class="o">+</span> <span class="n">context_c</span>
            <span class="k">if</span> <span class="n">context_wc</span> <span class="ow">in</span> <span class="n">context_dictionary</span><span class="p">:</span>
                <span class="n">context_w</span> <span class="o">=</span> <span class="n">context_wc</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">context_w</span> <span class="ow">in</span> <span class="n">context_dictionaryToCreate</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">ord</span><span class="p">(</span><span class="n">context_w</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">context_numBits</span><span class="p">):</span>
                            <span class="n">context_data_val</span> <span class="o">=</span> <span class="p">(</span><span class="n">context_data_val</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">context_data_position</span> <span class="o">==</span> <span class="n">bitsPerChar</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                                <span class="n">context_data_position</span> <span class="o">=</span> <span class="mi">0</span>
                                <span class="n">context_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getCharFromInt</span><span class="p">(</span><span class="n">context_data_val</span><span class="p">))</span>
                                <span class="n">context_data_val</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">context_data_position</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">context_w</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
                            <span class="n">context_data_val</span> <span class="o">=</span> <span class="p">(</span><span class="n">context_data_val</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">context_data_position</span> <span class="o">==</span> <span class="n">bitsPerChar</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">context_data_position</span> <span class="o">=</span> <span class="mi">0</span>
                                <span class="n">context_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getCharFromInt</span><span class="p">(</span><span class="n">context_data_val</span><span class="p">))</span>
                                <span class="n">context_data_val</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">context_data_position</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">context_numBits</span><span class="p">):</span>
                            <span class="n">context_data_val</span> <span class="o">=</span> <span class="p">(</span><span class="n">context_data_val</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="n">value</span>
                            <span class="k">if</span> <span class="n">context_data_position</span> <span class="o">==</span> <span class="n">bitsPerChar</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">context_data_position</span> <span class="o">=</span> <span class="mi">0</span>
                                <span class="n">context_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getCharFromInt</span><span class="p">(</span><span class="n">context_data_val</span><span class="p">))</span>
                                <span class="n">context_data_val</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">context_data_position</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">context_w</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
                            <span class="n">context_data_val</span> <span class="o">=</span> <span class="p">(</span><span class="n">context_data_val</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">context_data_position</span> <span class="o">==</span> <span class="n">bitsPerChar</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">context_data_position</span> <span class="o">=</span> <span class="mi">0</span>
                                <span class="n">context_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getCharFromInt</span><span class="p">(</span><span class="n">context_data_val</span><span class="p">))</span>
                                <span class="n">context_data_val</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">context_data_position</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
                    <span class="n">context_enlargeIn</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">context_enlargeIn</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">context_enlargeIn</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">context_numBits</span><span class="p">)</span>
                        <span class="n">context_numBits</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">del</span> <span class="n">context_dictionaryToCreate</span><span class="p">[</span><span class="n">context_w</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">context_dictionary</span><span class="p">[</span><span class="n">context_w</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">context_numBits</span><span class="p">):</span>
                        <span class="n">context_data_val</span> <span class="o">=</span> <span class="p">(</span><span class="n">context_data_val</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">context_data_position</span> <span class="o">==</span> <span class="n">bitsPerChar</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">context_data_position</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="n">context_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getCharFromInt</span><span class="p">(</span><span class="n">context_data_val</span><span class="p">))</span>
                            <span class="n">context_data_val</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">context_data_position</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>

                <span class="n">context_enlargeIn</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">context_enlargeIn</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">context_enlargeIn</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">context_numBits</span><span class="p">)</span>
                    <span class="n">context_numBits</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="c1"># Add wc to the dictionary.</span>
                <span class="n">context_dictionary</span><span class="p">[</span><span class="n">context_wc</span><span class="p">]</span> <span class="o">=</span> <span class="n">context_dictSize</span>
                <span class="n">context_dictSize</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">context_w</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">context_c</span><span class="p">)</span>

        <span class="c1"># Output the code for w.</span>
        <span class="k">if</span> <span class="n">context_w</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">context_w</span> <span class="ow">in</span> <span class="n">context_dictionaryToCreate</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">ord</span><span class="p">(</span><span class="n">context_w</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">context_numBits</span><span class="p">):</span>
                        <span class="n">context_data_val</span> <span class="o">=</span> <span class="p">(</span><span class="n">context_data_val</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">context_data_position</span> <span class="o">==</span> <span class="n">bitsPerChar</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">context_data_position</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="n">context_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getCharFromInt</span><span class="p">(</span><span class="n">context_data_val</span><span class="p">))</span>
                            <span class="n">context_data_val</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">context_data_position</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">context_w</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
                        <span class="n">context_data_val</span> <span class="o">=</span> <span class="p">(</span><span class="n">context_data_val</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">context_data_position</span> <span class="o">==</span> <span class="n">bitsPerChar</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">context_data_position</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="n">context_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getCharFromInt</span><span class="p">(</span><span class="n">context_data_val</span><span class="p">))</span>
                            <span class="n">context_data_val</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">context_data_position</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">context_numBits</span><span class="p">):</span>
                        <span class="n">context_data_val</span> <span class="o">=</span> <span class="p">(</span><span class="n">context_data_val</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="n">value</span>
                        <span class="k">if</span> <span class="n">context_data_position</span> <span class="o">==</span> <span class="n">bitsPerChar</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">context_data_position</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="n">context_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getCharFromInt</span><span class="p">(</span><span class="n">context_data_val</span><span class="p">))</span>
                            <span class="n">context_data_val</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">context_data_position</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">context_w</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
                        <span class="n">context_data_val</span> <span class="o">=</span> <span class="p">(</span><span class="n">context_data_val</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">context_data_position</span> <span class="o">==</span> <span class="n">bitsPerChar</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">context_data_position</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="n">context_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getCharFromInt</span><span class="p">(</span><span class="n">context_data_val</span><span class="p">))</span>
                            <span class="n">context_data_val</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">context_data_position</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
                <span class="n">context_enlargeIn</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">context_enlargeIn</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">context_enlargeIn</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">context_numBits</span><span class="p">)</span>
                    <span class="n">context_numBits</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">del</span> <span class="n">context_dictionaryToCreate</span><span class="p">[</span><span class="n">context_w</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">context_dictionary</span><span class="p">[</span><span class="n">context_w</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">context_numBits</span><span class="p">):</span>
                    <span class="n">context_data_val</span> <span class="o">=</span> <span class="p">(</span><span class="n">context_data_val</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">context_data_position</span> <span class="o">==</span> <span class="n">bitsPerChar</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">context_data_position</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">context_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getCharFromInt</span><span class="p">(</span><span class="n">context_data_val</span><span class="p">))</span>
                        <span class="n">context_data_val</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">context_data_position</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>

        <span class="n">context_enlargeIn</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">context_enlargeIn</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">context_enlargeIn</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">context_numBits</span><span class="p">)</span>
            <span class="n">context_numBits</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Mark the end of the stream</span>
        <span class="n">value</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">context_numBits</span><span class="p">):</span>
            <span class="n">context_data_val</span> <span class="o">=</span> <span class="p">(</span><span class="n">context_data_val</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">context_data_position</span> <span class="o">==</span> <span class="n">bitsPerChar</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">context_data_position</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">context_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getCharFromInt</span><span class="p">(</span><span class="n">context_data_val</span><span class="p">))</span>
                <span class="n">context_data_val</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">context_data_position</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>

        <span class="c1"># Flush the last char</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">context_data_val</span> <span class="o">=</span> <span class="p">(</span><span class="n">context_data_val</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">context_data_position</span> <span class="o">==</span> <span class="n">bitsPerChar</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">context_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getCharFromInt</span><span class="p">(</span><span class="n">context_data_val</span><span class="p">))</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">context_data_position</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">context_data</span><span class="p">)</span>

<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="k">class</span> <span class="nc">PixelblazeEnumerator</span><span class="p">:</span><span id="pixelblaze.PixelblazeEnumerator"></span><a class="mkapi-docs-link" title="pixelblaze.PixelblazeEnumerator" href="../../pixelblaze/#pixelblaze.PixelblazeEnumerator">DOCS</a>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Listens on a network to detect available Pixelblazes, which the user can then list</span>
<span class="sd">    or open as Pixelblaze objects.  Also provides time synchronization services for</span>
<span class="sd">    running synchronized patterns on a network of Pixelblazes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">PORT</span> <span class="o">=</span> <span class="mi">1889</span>
    <span class="n">SYNC_ID</span> <span class="o">=</span> <span class="mi">890</span>
    <span class="n">BEACON_PACKET</span> <span class="o">=</span> <span class="mi">42</span>
    <span class="n">TIMESYNC_PACKET</span> <span class="o">=</span> <span class="mi">43</span>
    <span class="n">DEVICE_TIMEOUT</span> <span class="o">=</span> <span class="mi">30000</span>
    <span class="n">LIST_CHECK_INTERVAL</span> <span class="o">=</span> <span class="mi">5000</span>

    <span class="n">listTimeoutCheck</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">isRunning</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">threadObj</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">listener</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">devices</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">autoSync</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hostIP</span><span class="o">=</span><span class="s2">&quot;0.0.0.0&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an object that listens continuously for Pixelblaze beacon</span>
<span class="sd">        packets, maintains a list of Pixelblazes and supports synchronizing time</span>
<span class="sd">        on multiple Pixelblazes to allows them to run patterns simultaneously.</span>
<span class="sd">        Takes the IPv4 address of the interface to use for listening on the calling computer.</span>
<span class="sd">        Listens on all available interfaces if hostIP is not specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">hostIP</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_time_in_millis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Utility Method: Returns last 32 bits of the current time in milliseconds</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span> <span class="o">%</span> <span class="mh">0xFFFFFFFF</span>

    <span class="k">def</span> <span class="nf">_unpack_beacon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Utility Method: Unpacks data from a Pixelblaze beacon</span>
<span class="sd">        packet, returning a 3 element list which contains</span>
<span class="sd">        (packet_type, sender_id, sender_time)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;LLL&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pack_timesync</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">now</span><span class="p">,</span> <span class="n">sender_id</span><span class="p">,</span> <span class="n">sender_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Utility Method: Builds a Pixelblaze timesync packet from</span>
<span class="sd">        supplied data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;LLLLL&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TIMESYNC_PACKET</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SYNC_ID</span><span class="p">,</span>
                           <span class="n">now</span><span class="p">,</span> <span class="n">sender_id</span><span class="p">,</span> <span class="n">sender_time</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_timesync_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility Method:  Sets the PixelblazeEnumerator object&#39;s network</span>
<span class="sd">           id for time synchronization. At the moment, any 32 bit value will</span>
<span class="sd">           do, and calling this method does (almost) nothing.  In the</span>
<span class="sd">           future, the ID might be used to determine priority among multiple time sources.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SYNC_ID</span> <span class="o">=</span> <span class="nb">id</span>

    <span class="k">def</span> <span class="nf">setDeviceTimeout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ms</span><span class="p">):</span><span id="pixelblaze.PixelblazeEnumerator.setDeviceTimeout"></span><a class="mkapi-docs-link" title="pixelblaze.PixelblazeEnumerator.setDeviceTimeout" href="../../pixelblaze/#pixelblaze.PixelblazeEnumerator.setDeviceTimeout">DOCS</a>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the interval in milliseconds which the enumerator will wait without</span>
<span class="sd">        hearing from a device before removing it from the active devices list.</span>

<span class="sd">        The default timeout is 30000 (30 seconds).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DEVICE_TIMEOUT</span> <span class="o">=</span> <span class="n">ms</span>

    <span class="k">def</span> <span class="nf">enableTimesync</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span><span id="pixelblaze.PixelblazeEnumerator.enableTimesync"></span><a class="mkapi-docs-link" title="pixelblaze.PixelblazeEnumerator.enableTimesync" href="../../pixelblaze/#pixelblaze.PixelblazeEnumerator.enableTimesync">DOCS</a>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instructs the PixelblazeEnumerator object to automatically synchronize</span>
<span class="sd">        time on all Pixelblazes. (Note that time synchronization</span>
<span class="sd">        is off by default when a new PixelblazeEnumerator is created.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autoSync</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">disableTimesync</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span><span id="pixelblaze.PixelblazeEnumerator.disableTimesync"></span><a class="mkapi-docs-link" title="pixelblaze.PixelblazeEnumerator.disableTimesync" href="../../pixelblaze/#pixelblaze.PixelblazeEnumerator.disableTimesync">DOCS</a>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Turns off the time synchronization -- the PixelblazeEnumerator will not</span>
<span class="sd">        automatically synchronize Pixelblazes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autoSync</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hostIP</span><span class="p">):</span><span id="pixelblaze.PixelblazeEnumerator.start"></span><a class="mkapi-docs-link" title="pixelblaze.PixelblazeEnumerator.start" href="../../pixelblaze/#pixelblaze.PixelblazeEnumerator.start">DOCS</a>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open socket for listening to Pixelblaze datagram traffic,</span>
<span class="sd">        set appropriate options and bind to specified interface and</span>
<span class="sd">        start listener thread.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">listener</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">listener</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">listener</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="n">hostIP</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PORT</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">threadObj</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_listen</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isRunning</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">listTimeoutCheck</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">threadObj</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span><span id="pixelblaze.PixelblazeEnumerator.stop"></span><a class="mkapi-docs-link" title="pixelblaze.PixelblazeEnumerator.stop" href="../../pixelblaze/#pixelblaze.PixelblazeEnumerator.stop">DOCS</a>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop listening for datagrams, terminate listener thread and close socket.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">listener</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isRunning</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">threadObj</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">listener</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">threadObj</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">listener</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_send_timesync</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">now</span><span class="p">,</span> <span class="n">sender_id</span><span class="p">,</span> <span class="n">sender_time</span><span class="p">,</span> <span class="n">addr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Utility Method: Composes and sends a timesync packet to a single Pixelblaze</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">listener</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pack_timesync</span><span class="p">(</span><span class="n">now</span><span class="p">,</span> <span class="n">sender_id</span><span class="p">,</span> <span class="n">sender_time</span><span class="p">),</span> <span class="n">addr</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_listen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal Method: Datagram listener thread handler -- loop and listen.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">isRunning</span><span class="p">:</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listener</span><span class="o">.</span><span class="n">recvfrom</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
            <span class="n">now</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_in_millis</span><span class="p">()</span>

            <span class="c1"># check the list periodically,and remove devices we haven&#39;t seen in a while</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">listTimeoutCheck</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LIST_CHECK_INTERVAL</span><span class="p">:</span>
                <span class="n">newlist</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

                <span class="k">for</span> <span class="n">dev</span><span class="p">,</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">record</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEVICE_TIMEOUT</span><span class="p">:</span>
                        <span class="n">newlist</span><span class="p">[</span><span class="n">dev</span><span class="p">]</span> <span class="o">=</span> <span class="n">record</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">devices</span> <span class="o">=</span> <span class="n">newlist</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">listTimeoutCheck</span> <span class="o">=</span> <span class="n">now</span>

            <span class="c1"># when we receive a beacon packet from a Pixelblaze,</span>
            <span class="c1"># update device record and timestamp in our device list</span>
            <span class="n">pkt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unpack_beacon</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pkt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">BEACON_PACKET</span><span class="p">:</span>
                <span class="c1"># add pixelblaze to list of devices</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="n">pkt</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="n">addr</span><span class="p">,</span>
                                        <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">now</span><span class="p">,</span>
                                        <span class="s2">&quot;sender_id&quot;</span><span class="p">:</span> <span class="n">pkt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                        <span class="s2">&quot;sender_time&quot;</span><span class="p">:</span> <span class="n">pkt</span><span class="p">[</span><span class="mi">2</span><span class="p">]}</span>

                <span class="c1"># immediately send timesync if enabled</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoSync</span><span class="p">:</span> <span class="c1"># send</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_send_timesync</span><span class="p">(</span><span class="n">now</span><span class="p">,</span> <span class="n">pkt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pkt</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">addr</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">pkt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">TIMESYNC_PACKET</span><span class="p">:</span>   <span class="c1"># always defer to other time sources</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoSync</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">disableTimesync</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">getPixelblazeList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dev</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">dev</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># just the ip</span>
        <span class="k">return</span> <span class="n">dev</span>
</code></pre></div>
</div>
</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.sections", "navigation.indexes"], "search": "../../../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.37e9125f.min.js"></script>
      
        <script src="../../../js/mkapi.js"></script>
      
    
  </body>
</html>